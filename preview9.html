<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <title>تقرير جلسات مجتمعات التعلم المهنية - جاهز للتحميل والطباعة</title>
    <style>
      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
      }
      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 90%;
        width: 100%;
        max-width: 1200px;
        position: relative;
        margin: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      .modal-body {
        padding: 20px;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background-color: #f3f4f6;
        color: #111827;
      }
      .preview-template {
        background: white;
        padding: 40px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
      }
      .error-message {
        color: #dc2626;
        font-size: 14px;
        margin-top: 4px;
        display: none;
      }
      .error-message.show {
        display: block;
      }
      .field-error {
        border-color: #dc2626 !important;
        border-width: 2px !important;
      }
      .field-error:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      }
    </style>
  </head>
  <body>
    <div class="max-w-6xl mx-auto">
      <div
        class="max-w-4xl mx-auto border-4 rounded-2xl shadow-xl overflow-hidden mb-8 p-4"
        id="template"
      >
        <div class="bg-white rounded-xl p-6">
          <div
            class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
          >
            <img
              src="./assets/imgs/card9/sub-period.webp"
              alt="img-title"
              class="w-full h-full object-cover rounded-full"
            />
          </div>
          <h1 class="text-4xl text-center">تقرير تنفيذ حصة إنتظار</h1>
          <p class="text-gray-700 my-4 text-center text-xl">
            نموذج لإنشاء تقرير تنفيذ حصة إنتظار من جوالك مباشرة
          </p>

          <!-- نموذج الاستمارة -->
          <div class="mt-8 bg-white border border-gray-300 rounded-lg p-6">
            <!-- القسم العلوي: إدارة التعليم -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                إدارة التعليم، اسم المدرسة
              </label>
              <textarea
                id="eduInfo"
                class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                rows="3"
              >
الإدارة العامة للتعليم
بالمنطقة
مدرسة</textarea
              >
              <div id="eduInfoError" class="error-message">هذا الحقل مطلوب</div>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  اسم المعلم/ة الأساسيـ/ة:
                </label>
                <input
                  type="text"
                  id="visitedTeacher"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="اسم المعلم"
                />
                <div id="visitedTeacherError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  الصف / الفصل:
                </label>
                <input
                  type="text"
                  id="gradeClass"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="الصف"
                />
                <div id="gradeClassError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  اليوم والتاريخ:
                </label>
                <input
                  type="text"
                  id="dayDate"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="الأحد - ١٤٤٧/١٢/١٢هـ"
                />
                <div id="dayDateError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  الحصة:
                </label>
                <input
                  type="text"
                  id="session"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="الحصة الأولى"
                />
                <div id="sessionError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  المادة / النشاط المنفذ:
                </label>
                <input
                  type="text"
                  id="subject"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="علوم - جهاز الدوران"
                />
                <div id="subjectError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  مكان التنفيذ:
                </label>
                <input
                  type="text"
                  id="location"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="غرفة المصادر"
                />
                <div id="locationError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  وسائل وطرق التنفيذ:
                </label>
                <textarea
                  id="implementationMethods"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 overflow-hidden"
                  rows="4"
                >
عرض مقطع فيديو

أوراق عمل

حوار ونقاش</textarea
                >
                <div id="implementationMethodsError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  الهدف العام:
                </label>
                <input
                  type="text"
                  id="generalObjective"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  value="استثمار وقت حصص الانتظار بزيادة التحصيل العلمي للطلاب"
                />
                <div id="generalObjectiveError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
            </div>

            <!-- وصف ما تم إنجازه وملاحظات -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  وصف ماتم إنجازه بالحصة:
                </label>
                <textarea
                  id="achievementDescription"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="6"
                >
تم عرض مقطع فيديو على الطلاب مع تزويدهم بورقة عمل، وتم طلب منهم محاولة حل الورقة من المحتوى الذي تم عرضه بالفيديو، وعند الانتهاء من عرض المقطع وحل الورقة تمت مناقشتهم والتحاور معهم حول الإجابات.</textarea
                >
                <div id="achievementDescriptionError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  ملاحظات / توصيات :
                </label>
                <textarea
                  id="notesRecommendations"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="6"
                >
الفصل كان ممتاز من الناحية الإنضباطية، كما أبدى الطلاب مستوى عالي من الفهم والمبادرة بالمشاركة والنقاش حول المادة.</textarea
                >
                <div id="notesRecommendationsError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
            </div>

            <!-- التوقيعات الثلاثة -->
            <div class="grid grid-cols-3 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  وظيفة واسم التوقيع الأيمن:
                </label>
                <textarea
                  id="rightSignature"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"
                >
المعلم المنفذ
الاسم</textarea
                >
                <div id="rightSignatureError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  وظيفة واسم التوقيع الأوسط:
                </label>
                <textarea
                  id="middleSignature"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"
                >
وظيفة واسم التوقيع الأوسط</textarea
                >
                <div id="middleSignatureError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  وظيفة واسم التوقيع الأيسر:
                </label>
                <textarea
                  id="leftSignature"
                  class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
                  rows="3"
                >
مدير المدرسة
الاسم</textarea
                >
                <div id="leftSignatureError" class="error-message">
                  هذا الحقل مطلوب
                </div>
              </div>
            </div>

            <!-- رفع الملفات والباركود -->
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  صورة الشاهد الأول:
                </label>
                <input
                  type="file"
                  id="firstWitnessPhoto"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  accept="image/*"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  صورة الشاهد الثاني:
                </label>
                <input
                  type="file"
                  id="secondWitnessPhoto"
                  class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  accept="image/*"
                />
              </div>
            </div>

            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                ضع رابط الشواهد إن وجد لإنشاء باركود ووضعه بالنموذج :
              </label>
              <input
                type="text"
                id="barcodeLink"
                class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="ضع رابط الشواهد إن وجد لإنشاء باركود ووضعه بالنموذج :"
              />
              <p class="text-xs text-gray-500 mt-1">
                سيتم إنشاء باركود تلقائياً / حقل غير إلزامي تجاهله إذا كنت لا
                تريد باركود
              </p>
            </div>

            <!-- زر المعاينة -->
            <div class="mt-8">
              <button
                onclick="previewTemplate()"
                class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition-colors"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  />
                </svg>
                <span>معاينة</span>
              </button>
            </div>

            <!-- أكثر الروابط استخداماً -->
            <div
              class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 mb-8 mt-8"
            >
              <h2 class="text-lg font-bold text-gray-800 mb-4">
                أكثر الروابط استخداماً
              </h2>
              <div class="grid grid-cols-2 gap-4">
                <!-- الصف الأول -->
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  أفضل نموذج لتوثيق برنامج أو نشاط (المطور)
                </button>
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  تقرير جاهز لليوم العالمي للفيزياء الطبية
                </button>
                <!-- الصف الثاني -->
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  نموذج تنفيذ استراتيجية مختصرة
                </button>
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  خطط علاجية وإثرائية
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="max-w-4xl mx-auto bg-white rounded-xl p-6 mb-8 border shadow-lg"
    >
      <div class="space-y-4">
        <div class="pb-4">
          <div class="flex justify-between flex-col items-center">
            <span class="text-2xl text-gray-700 font-medium"
              >عدد الخدمات المنفذة:</span
            >
            <span class="text-2xl font-medium text-gray-800">2186208</span>
          </div>
        </div>
      </div>
    </div>
    <div
      class="max-w-4xl mx-auto bg-white rounded-xl p-6 mb-8 border shadow-lg"
    >
      <div class="space-y-4">
        <div class="pb-4">
          <div class="flex justify-between flex-col items-center">
            <span class="text-gray-700 font-medium text-2xl"
              >عدد سجلات شواهد تقيم الأداء المنفذة:</span
            >
            <span class="text-2xl font-medium text-gray-800">6321</span>
          </div>
        </div>
      </div>
    </div>

    <!-- الفوتر -->
    <footer class="mt-12 border-t border-gray-300 pt-6 pb-8">
      <div class="max-w-6xl mx-auto">
        <div
          class="flex flex-wrap justify-center items-center gap-4 text-gray-700 text-sm mb-4"
        >
          <a href="#" class="hover:text-green-600 transition">من نحن</a>
          <span class="text-gray-400">|</span>
          <a href="#" class="hover:text-green-600 transition">سياسة الخصوصية</a>
          <span class="text-gray-400">|</span>
          <a href="#" class="hover:text-green-600 transition"
            >اتفاقية الاستخدام</a
          >
          <span class="text-gray-400">|</span>
          <a
            href="#"
            class="hover:text-green-600 transition flex items-center gap-1"
          >
            تويتر
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-4 h-4"
            >
              <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
              />
            </svg>
          </a>
          <span class="text-gray-400">|</span>
          <a
            href="#"
            class="hover:text-green-600 transition flex items-center gap-1"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-4 h-4"
            >
              <path
                fill-rule="evenodd"
                d="M1.5 4.5a3 3 0 013-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 01-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 006.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 011.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 01-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5z"
                clip-rule="evenodd"
              />
            </svg>
            اتصل بنا
          </a>
        </div>
        <div class="text-center text-gray-600 text-sm">
          edu-forms.com, Inc 2025 ©
        </div>
      </div>
    </footer>

    <!-- Modal Popup للمعاينة -->
    <div id="previewModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="text-2xl font-bold text-gray-800">
            معاينة تقرير تنفيذ حصة إنتظار
          </h2>
          <button class="modal-close" onclick="closePreviewModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="previewTemplateContent" class="preview-template">
            <!-- سيتم ملء المحتوى ديناميكياً -->
          </div>
          <div class="flex justify-center gap-4 mt-6">
            <button
              onclick="downloadImageFromModal()"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل كصورة
            </button>
            <button
              onclick="downloadPDFFromModal()"
              class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل PDF
            </button>
            <button
              onclick="closePreviewModal()"
              class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 transition"
            >
              إغلاق
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // دالة للتحقق من صحة البيانات
      function validateForm() {
        let isValid = true;

        // إزالة جميع رسائل الخطأ السابقة
        document.querySelectorAll(".field-error").forEach((field) => {
          field.classList.remove("field-error");
        });
        document.querySelectorAll(".error-message").forEach((error) => {
          error.classList.remove("show");
        });

        // التحقق من إدارة التعليم
        const eduInfo = document.getElementById("eduInfo").value.trim();
        if (!eduInfo) {
          showError("eduInfo", "eduInfoError");
          isValid = false;
        }

        // التحقق من اسم المعلم الأساسي
        const visitedTeacher = document
          .getElementById("visitedTeacher")
          .value.trim();
        if (!visitedTeacher) {
          showError("visitedTeacher", "visitedTeacherError");
          isValid = false;
        }

        // التحقق من الصف / الفصل
        const gradeClass = document.getElementById("gradeClass").value.trim();
        if (!gradeClass) {
          showError("gradeClass", "gradeClassError");
          isValid = false;
        }

        // التحقق من اليوم والتاريخ
        const dayDate = document.getElementById("dayDate").value.trim();
        if (!dayDate) {
          showError("dayDate", "dayDateError");
          isValid = false;
        }

        // التحقق من الحصة
        const session = document.getElementById("session").value.trim();
        if (!session) {
          showError("session", "sessionError");
          isValid = false;
        }

        // التحقق من المادة / النشاط المنفذ
        const subject = document.getElementById("subject").value.trim();
        if (!subject) {
          showError("subject", "subjectError");
          isValid = false;
        }

        // التحقق من مكان التنفيذ
        const location = document.getElementById("location").value.trim();
        if (!location) {
          showError("location", "locationError");
          isValid = false;
        }

        // التحقق من وسائل وطرق التنفيذ
        const implementationMethods = document
          .getElementById("implementationMethods")
          .value.trim();
        if (!implementationMethods) {
          showError("implementationMethods", "implementationMethodsError");
          isValid = false;
        }

        // التحقق من الهدف العام
        const generalObjective = document
          .getElementById("generalObjective")
          .value.trim();
        if (!generalObjective) {
          showError("generalObjective", "generalObjectiveError");
          isValid = false;
        }

        // التحقق من وصف ما تم إنجازه
        const achievementDescription = document
          .getElementById("achievementDescription")
          .value.trim();
        if (!achievementDescription) {
          showError("achievementDescription", "achievementDescriptionError");
          isValid = false;
        }

        // التحقق من الملاحظات / التوصيات
        const notesRecommendations = document
          .getElementById("notesRecommendations")
          .value.trim();
        if (!notesRecommendations) {
          showError("notesRecommendations", "notesRecommendationsError");
          isValid = false;
        }

        // التحقق من التوقيع الأيمن
        const rightSignature = document
          .getElementById("rightSignature")
          .value.trim();
        if (!rightSignature) {
          showError("rightSignature", "rightSignatureError");
          isValid = false;
        }

        // التحقق من التوقيع الأوسط
        const middleSignature = document
          .getElementById("middleSignature")
          .value.trim();
        if (!middleSignature) {
          showError("middleSignature", "middleSignatureError");
          isValid = false;
        }

        // التحقق من التوقيع الأيسر
        const leftSignature = document
          .getElementById("leftSignature")
          .value.trim();
        if (!leftSignature) {
          showError("leftSignature", "leftSignatureError");
          isValid = false;
        }

        return isValid;
      }

      // دالة لإظهار رسالة الخطأ
      function showError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field) {
          field.classList.add("field-error");
        }
        if (error) {
          error.classList.add("show");
        }
      }

      // إزالة رسالة الخطأ عند الكتابة
      function setupFieldValidation() {
        const textFields = [
          "eduInfo",
          "visitedTeacher",
          "gradeClass",
          "dayDate",
          "session",
          "subject",
          "location",
          "implementationMethods",
          "generalObjective",
          "achievementDescription",
          "notesRecommendations",
          "rightSignature",
          "middleSignature",
          "leftSignature",
        ];

        // معالجة حقول النص
        textFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("input", function () {
              this.classList.remove("field-error");
              const errorId = fieldId + "Error";
              const error = document.getElementById(errorId);
              if (error) {
                error.classList.remove("show");
              }
            });
          }
        });
      }

      // دالة المعاينة
      function previewTemplate() {
        // التحقق من صحة البيانات أولاً
        if (!validateForm()) {
          // التمرير إلى أول حقل به خطأ
          const firstError = document.querySelector(".field-error");
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          return;
        }

        // إذا كانت البيانات صحيحة، توليد محتوى المعاينة وفتح الـ modal
        generatePreviewContent();
        openPreviewModal();
      }

      // توليد محتوى المعاينة
      function generatePreviewContent() {
        const eduInfoText =
          document.getElementById("eduInfo").value ||
          "الإدارة العامة للتعليم\nبالمنطقة\nمدرسة";
        const eduInfoLines = eduInfoText.split("\n");
        const eduInfo = eduInfoLines[0] || "الإدارة العامة للتعليم";
        const region = eduInfoLines[1] || "بالمنطقة";
        const schoolName = eduInfoLines[2] || "مدرسة";
        const visitedTeacher =
          document.getElementById("visitedTeacher").value || "اسم المعلم";
        const gradeClass = document.getElementById("gradeClass").value || "الصف";
        const dayDate =
          document.getElementById("dayDate").value || "الأحد - ١٤٤٧/١٢/١٢هـ";
        const session =
          document.getElementById("session").value || "الحصة الأولى";
        const subject =
          document.getElementById("subject").value || "علوم - جهاز الدوران";
        const location =
          document.getElementById("location").value || "غرفة المصادر";
        const implementationMethods =
          document.getElementById("implementationMethods").value ||
          "عرض مقطع فيديو\n\nأوراق عمل\n\nحوار ونقاش";
        const generalObjective =
          document.getElementById("generalObjective").value ||
          "استثمار وقت حصص الانتظار بزيادة التحصيل العلمي للطلاب";
        const achievementDescription =
          document.getElementById("achievementDescription").value ||
          "تم عرض مقطع فيديو على الطلاب مع تزويدهم بورقة عمل، وتم طلب منهم محاولة حل الورقة من المحتوى الذي تم عرضه بالفيديو، وعند الانتهاء من عرض المقطع وحل الورقة تمت مناقشتهم والتحاور معهم حول الإجابات.";
        const notesRecommendations =
          document.getElementById("notesRecommendations").value ||
          "الفصل كان ممتاز من الناحية الإنضباطية، كما أبدى الطلاب مستوى عالي من الفهم والمبادرة بالمشاركة والنقاش حول المادة.";
        const rightSignature =
          document.getElementById("rightSignature").value ||
          "المعلم المنفذ\nالاسم";
        const middleSignature =
          document.getElementById("middleSignature").value ||
          "وظيفة واسم التوقيع الأوسط";
        const leftSignature =
          document.getElementById("leftSignature").value ||
          "مدير المدرسة\nالاسم";
        const barcodeLink = document.getElementById("barcodeLink").value || "";

        const previewContainer = document.getElementById(
          "previewTemplateContent"
        );

        // إنشاء HTML للمعاينة
        const html = `
          <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl p-6">
              <div
                class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
              >
                <img
                  src="./assets/imgs/card5/weekly-plans (1).webp"
                  alt="img-title"
                  class="w-full h-full object-cover rounded-full"
                />
              </div>
              <h1 class="text-4xl text-center mb-4">تقرير تنفيذ حصة إنتظار</h1>
              <p class="text-gray-700 my-4 text-center text-xl">
                نموذج لإنشاء تقرير تنفيذ حصة إنتظار من جوالك مباشرة
              </p>
              
              <div class="mt-8 bg-white border border-gray-300 rounded-lg p-6">
                <!-- القسم العلوي: إدارة التعليم -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    إدارة التعليم، اسم المدرسة
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600">
                    <p>${eduInfo}</p>
                    <p>${region}</p>
                    <p class="font-bold">${schoolName}</p>
                  </div>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      اسم المعلم/ة الأساسيـ/ة:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${visitedTeacher}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      الصف / الفصل:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${gradeClass}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      اليوم والتاريخ:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${dayDate}
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      الحصة:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${session}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      المادة / النشاط المنفذ:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${subject}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      مكان التنفيذ:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${location}
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      وسائل وطرق التنفيذ:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[80px]">
                      ${implementationMethods}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      الهدف العام:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                      ${generalObjective}
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      وصف ماتم إنجازه بالحصة:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[120px]">
                      ${achievementDescription}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      ملاحظات / توصيات :
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[120px]">
                      ${notesRecommendations}
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-3 gap-4 mb-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      وظيفة واسم التوقيع الأيمن:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[60px]">
                      ${rightSignature}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      وظيفة واسم التوقيع الأوسط:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[60px]">
                      ${middleSignature}
                    </div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                      وظيفة واسم التوقيع الأيسر:
                    </label>
                    <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 whitespace-pre-line min-h-[60px]">
                      ${leftSignature}
                    </div>
                  </div>
                </div>

                ${
                  barcodeLink
                    ? `
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    رابط الشواهد:
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600">
                    ${barcodeLink}
                  </div>
                </div>
                `
                    : ""
                }
              </div>
            </div>
          </div>
        `;

        previewContainer.innerHTML = html;
      }

      // فتح الـ modal
      function openPreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // إغلاق الـ modal
      function closePreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // إغلاق الـ modal عند الضغط خارج المحتوى
      document
        .getElementById("previewModal")
        ?.addEventListener("click", function (e) {
          if (e.target === this) {
            closePreviewModal();
          }
        });

      // إغلاق الـ modal عند الضغط على ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closePreviewModal();
        }
      });

      // تحميل الصورة من الـ modal
      function downloadImageFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "plc-session-report-preview.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      // تحميل PDF من الـ modal
      function downloadPDFFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const imgData = canvas.toDataURL("image/jpeg");
          const pdf = new jspdf.jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
          pdf.save("plc-session-report-preview.pdf");
        });
      }

      // دالة لجعل textarea يتكيف تلقائياً مع المحتوى
      function autoResizeTextarea(textarea) {
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
        textarea.style.overflow = "hidden";
      }

      // تطبيق على textarea وسائل وطرق التنفيذ عند تحميل الصفحة
      document.addEventListener("DOMContentLoaded", function () {
        // إعداد الـ validation
        setupFieldValidation();

        // تطبيق auto-resize على textarea وسائل وطرق التنفيذ
        const implementationMethodsTextarea = document.getElementById(
          "implementationMethods"
        );
        if (implementationMethodsTextarea) {
          // تطبيق عند تحميل الصفحة
          autoResizeTextarea(implementationMethodsTextarea);
          // تطبيق عند الكتابة
          implementationMethodsTextarea.addEventListener("input", function () {
            autoResizeTextarea(this);
          });
        }
      });
    </script>
  </body>
</html>
