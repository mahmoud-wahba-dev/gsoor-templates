<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <title>دعوة زواج | نماذج تعليمية</title>

    <style>
      body {
        font-family: "Helvetica", "Tajawal", sans-serif;
      }
      label {
        font-weight: 600;
        color: #136f3c;
        display: block;
        margin-bottom: 8px;
      }
      input[type="text"],
      input[type="date"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
        font-size: 14px;
      }
      /* تحسين textarea */
      textarea {
        min-height: 80px;
        line-height: 1.8;
        font-size: 14px;
        padding: 12px;
        resize: vertical;
      }
      input[type="file"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
      }
      /* Toggle Switch Styles */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 26px;
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      .toggle-switch input:checked + .toggle-slider {
        background-color: #10b981;
      }
      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }
      /* Section Background */
      .section-bg {
        background-color: #f3f4f6;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 16px;
      }
      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
      }
      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 90%;
        width: 100%;
        max-width: 1200px;
        position: relative;
        margin: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      .modal-body {
        padding: 20px;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background-color: #f3f4f6;
        color: #111827;
      }
      .preview-template {
        background: white;
        padding: 40px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
      }
      /* Error Message Styles */
      .error-message {
        color: #dc2626;
        font-size: 14px;
        margin-top: 4px;
        display: none;
      }
      .error-message.show {
        display: block;
      }
      .field-error {
        border-color: #dc2626 !important;
        border-width: 2px !important;
      }
      .field-error:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      }
      /* Navbar Styles */
      .navbar {
        background-color: #f3f4f6;
        padding: 12px 0;
        border-bottom: 1px solid #e5e7eb;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        width: 100%;
        margin: 0;
      }
      .navbar-container {
        width: 100%;
        margin: 0;
        padding: 0 16px;
      }
      .navbar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }
      .navbar-title {
        font-size: 16px;
        font-weight: 600;
        color: #374151;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .navbar-icon {
        width: 20px;
        height: 20px;
        color: #3b82f6;
        flex-shrink: 0;
      }
      .navbar-menu {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 8px 12px;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .navbar-item {
        position: relative;
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .navbar-link {
        color: #374151;
        text-decoration: none;
        font-size: 18px;
        padding: 4px 6px;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: color 0.2s;
        white-space: nowrap;
      }
      .navbar-link:hover {
        color: #111827;
      }
      .dropdown-icon {
        width: 10px;
        height: 10px;
        color: #374151;
        margin-right: 4px;
      }
      .navbar-separator {
        color: #9ca3af;
        margin: 0 4px;
      }
      /* Mobile Menu Toggle */
      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        color: #374151;
        cursor: pointer;
        padding: 8px;
      }
      .mobile-menu {
        display: none;
        flex-direction: column;
        gap: 8px;
        padding: 12px 0;
        border-top: 1px solid #e5e7eb;
        margin-top: 8px;
      }
      .mobile-menu.active {
        display: flex;
      }
      /* Responsive Styles */
      @media (max-width: 1200px) {
        .navbar-menu {
          gap: 6px 12px;
        }
        .navbar-link {
          font-size: 13px;
          padding: 5px 6px;
        }
      }
      @media (max-width: 768px) {
        .navbar-container {
          padding: 0 12px;
        }
        .mobile-menu-toggle {
          display: block;
        }
        .navbar-menu {
          display: none;
        }
        .navbar-menu.mobile-active {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
          padding: 12px 0;
        }
        .navbar-item {
          width: 100%;
        }
        .navbar-link {
          width: 100%;
          padding: 10px 8px;
        }
        .navbar-separator {
          display: none;
        }
      }
    </style>
  </head>

  <body class="bg-gray-100 py-10">
     <!--Gsoor Nav Bar-->
    <!-- NAVBAR -->
    <header class="fixed inset-x-0 top-4 z-50 px-4 sm:px-6">
      <div class="max-w-6xl mx-auto relative">
        <div class="nav-pill px-3 py-2 flex items-center justify-between gap-3">
          <!-- LOGO -->
          <div class="flex items-center gap-4 ml-2">
            <a href="#" class="shrink-0">
              <img
                src="../assets/imgs/gsoor_logo.jpg"
                alt="logo"
                class="h-9 w-auto object-contain md:h-10"
              />
            </a>
          </div>

          <!-- NAV LINKS (desktop) -->
          <nav class="hidden md:flex items-center gap-8 text-sm text-gray-700">
            <a href="#" class="hover:text-cyan-600 transition">الشهادات</a>
            <a href="#" class="hover:text-cyan-600 transition"
              >الملفات الإدارية</a
            >
            <a href="#" class="hover:text-cyan-600 transition">البطاقات</a>
          </nav>

          <!-- UTILITY ICONS -->
          <div class="flex items-center gap-2">
            <div
              class="hidden sm:flex items-center bg-gray-50 rounded-full px-2 py-1 gap-2 border border-gray-100"
            >
              <button
                id="themeToggle"
                class="text-gray-600"
                title="تبديل الوضع"
              >
                <i class="fa-solid fa-moon text-gray-600 text-base"></i>
              </button>

              <button class="text-gray-600 relative" title="العربة">
                <i class="fa-solid fa-bag-shopping text-gray-600 text-base"></i>
                <span
                  id="cartBadge"
                  class="absolute -top-1 -left-2 bg-cyan-600 text-white text-xs rounded-full px-1"
                  >0</span
                >
              </button>

              <button id="profileBtn" class="text-gray-600" title="الحساب">
                <i class="fa-regular fa-user text-gray-600 text-base"></i>
              </button>
            </div>

            <!-- MOBILE MENU BUTTON -->
            <button
              id="menuBtn"
              class="md:hidden text-gray-600 p-2"
              aria-expanded="false"
            >
              <i class="fa-solid fa-bars text-lg"></i>
            </button>
          </div>
        </div>

        <!-- MOBILE NAV -->
        <div
          id="mobileNav"
          class="hidden mobile-nav-abs mt-2 bg-white rounded-2xl shadow-md p-3 mx-4"
        >
          <div class="flex flex-col gap-2 text-right">
            <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition"
              >الشهادات</a
            >
            <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition"
              >الملفات الإدارية</a
            >
            <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition"
              >البطاقات</a
            >
            <div
              class="pt-2 border-t border-gray-100 mt-2 flex justify-between items-center"
            >
              <div class="flex items-center gap-3">
                <button id="mobileThemeToggle" class="text-gray-600">
                  <i class="fa-solid fa-moon"></i>
                </button>
                <button class="text-gray-600 relative">
                  <i class="fa-solid fa-bag-shopping"></i>
                  <span
                    id="mobileCartBadge"
                    class="absolute -top-2 -left-2 bg-cyan-600 text-white text-xs rounded-full px-1"
                    >0</span
                  >
                </button>
              </div>
              <a href="#" class="text-sm text-cyan-600 font-semibold"
                >تسجيل دخول</a
              >
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-6xl mx-auto">
      <div
        class="max-w-4xl mx-auto border-4 rounded-2xl shadow-xl overflow-hidden mb-8 p-4"
        id="template"
      >
        <div class="bg-white rounded-xl p-6">
          <div
            class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
          >
            <img
              src="../assets//imgs//card3//global-strategic (1).webp"
              alt="img-title"
            />
          </div>
          <h1 class="text-5xl text-center">
            دعوة زواج
          </h1>
          <p class="text-gray-700 my-4 text-center text-xl">
            إنشاء وتخصيص دعوة زواج مع إمكانية تحرير وإضافة جميع البيانات الخاصة بك، بطريقة سهلة واحترافية توفر عليه الوقت والجهد ويتم حفظ الملف النهائي بتنسيق صورة أو ملف pdf لسهولة الطباعة بجودة عالية وإعادة الاستخدام.
          </p>
          <div class="p-6 space-y-6">
            <!-- قسم صورة العريس -->
            <div>
              <label class="mb-2">صورة العريس:</label>
              <input
                type="file"
                id="groomPhoto"
                accept="image/*"
                class="w-full border p-3 rounded-md bg-gray-50"
              />
              <div id="groomPhotoError" class="error-message">هذا الحقل مطلوب</div>
              <p class="text-gray-600 text-sm mt-2">يجب أن تكون الصورة بالطول وبحجم حالات الواتساب وستوري السناب</p>
              <div id="groomPhotoPreview" class="mt-2 hidden">
                <img
                  id="groomPhotoPreviewImg"
                  src=""
                  alt="Groom Photo Preview"
                  class="max-h-24 object-contain"
                />
              </div>
            </div>

            <!-- قسم الداعي للزواج -->
            <div>
              <label class="mb-2">الداعي للزواج:</label>
              <textarea id="weddingHost" class="w-full">
أتشرف بدعوتكم لحضور حفل تخرجي
              </textarea>
              <div id="weddingHostError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم الاسم -->
            <div>
              <label class="mb-2">الاسم:</label>
              <input
                type="text"
                id="groomName"
                placeholder="اسم الخريج"
                class="w-full"
              />
              <div id="groomNameError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم النص الإضافي -->
            <div>
              <label class="mb-2">نص إضافي:</label>
              <textarea id="additionalText" class="w-full">
وتناول طعام الغداء والعشاء
              </textarea>
              <div id="additionalTextError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم التاريخ -->
            <div>
              <label class="mb-2">التاريخ:</label>
              <textarea id="weddingDate" class="w-full">
وذلك يوم الأحد ليلة الأثنين
١٤٤٦/١٢/١٢هـ - ٢٠٢٦/١٢/٢٠م
              </textarea>
              <div id="weddingDateError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم الموقع -->
            <div>
              <label class="mb-2">الموقع:</label>
              <input
                type="text"
                id="weddingLocation"
                placeholder="قاعة الفخامة - الرياض"
                class="w-full"
              />
              <div id="weddingLocationError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم الاستفسار -->
            <div>
              <label class="mb-2">للاستفسار:</label>
              <textarea id="contactInfo" class="w-full">
٠٥٥٥٥٥٥٥٥٢ - ٠٥٥٥٥٥٥٥٥١
              </textarea>
              <div id="contactInfoError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- قسم الملاحظة -->
            <div>
              <label class="mb-2">ملاحظة:</label>
              <textarea id="note" class="w-full">
نعتذر عن قبول العانية
              </textarea>
              <div id="noteError" class="error-message">
                هذا الحقل مطلوب
              </div>
            </div>

            <!-- زر المعاينة -->
            <div class="flex justify-center mt-6 mb-8">
              <button
                onclick="previewTemplate()"
                class="bg-green-600 text-white px-8 py-4 rounded-lg font-bold text-lg flex items-center gap-3 hover:bg-green-700 transition"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  />
                </svg>
                معاينة
              </button>
            </div>
            
            <!-- قسم أكثر الروابط استخداماً -->
            <div
              class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 mb-8"
            >
              <h2 class="text-lg font-bold text-gray-800 mb-4">
                أكثر الروابط استخداماً
              </h2>
              <div class="grid grid-cols-2 gap-4">
                <!-- الصف الأول -->
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  دعوات زواج
                </button>
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  بطاقات تهنئة
                </button>
                <!-- الصف الثاني -->
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  بطاقات دعوة
                </button>
                <button
                  class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]"
                >
                  بطاقات أعياد الميلاد
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Popup للمعاينة -->
    <div id="previewModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="text-2xl font-bold text-gray-800">معاينة دعوة الزواج</h2>
          <button class="modal-close" onclick="closePreviewModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="previewTemplateContent" class="preview-template">
            <!-- سيتم ملء المحتوى ديناميكياً -->
          </div>
          <div class="flex justify-center gap-4 mt-6">
            <button
              onclick="downloadImageFromModal()"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل كصورة
            </button>
            <button
              onclick="downloadPDFFromModal()"
              class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل PDF
            </button>
            <button
              onclick="closePreviewModal()"
              class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 transition"
            >
              إغلاق
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم البيانات -->
    <div
      class="max-w-4xl mx-auto bg-white rounded-xl p-6 mb-8 border shadow-lg"
    >
      <div class="space-y-4">
        <div class="pb-4">
          <div class="flex justify-between flex-col items-center">
            <span class="text-2xl text-gray-700 font-medium"
              >عدد الخدمات المنفذة:</span
            >
            <span class="text-2xl font-medium text-gray-800">2184519</span>
          </div>
        </div>
      </div>
    </div>
    <div
      class="max-w-4xl mx-auto bg-white rounded-xl p-6 mb-8 border shadow-lg"
    >
      <div class="space-y-4">
        <div class="pb-4">
          <div class="flex justify-between flex-col items-center">
            <span class="text-gray-700 font-medium text-2xl"
              >عدد سجلات دعوات الزواج المنفذة</span
            >
            <span class="text-2xl font-medium text-gray-800">6321</span>
          </div>
        </div>
      </div>
    </div>

    <!-- الفوتر -->
    <footer class="mt-12 border-t border-gray-300 pt-6 pb-8">
      <div class="max-w-6xl mx-auto">
        <div
          class="flex flex-wrap justify-center items-center gap-4 text-gray-700 text-sm mb-4"
        >
          <a href="#" class="hover:text-green-600 transition">من نحن</a>
          <span class="text-gray-400">|</span>
          <a href="#" class="hover:text-green-600 transition">سياسة الخصوصية</a>
          <span class="text-gray-400">|</span>
          <a href="#" class="hover:text-green-600 transition"
            >اتفاقية الاستخدام</a
          >
          <span class="text-gray-400">|</span>
          <a
            href="#"
            class="hover:text-green-600 transition flex items-center gap-1"
          >
            تويتر
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-4 h-4"
            >
              <path
                d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
              />
            </svg>
          </a>
          <span class="text-gray-400">|</span>
          <a href="#" class="hover:text-green-600 transition">اتصل بنا</a>
        </div>
        <div class="text-center text-gray-600 text-sm">
          Gsoor.com, Inc 2025 ©
        </div>
      </div>
    </footer>

    <script>
      // دالة مساعدة لتحويل الملف إلى base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // دالة حفظ جميع البيانات في localStorage
      async function saveTemplateData() {
        try {
          // تحميل البيانات الموجودة أولاً للحفاظ على الملفات المحفوظة
          const existingData = JSON.parse(
            localStorage.getItem("weddingInvitationData") || "{}"
          );
          const data = { ...existingData };

          // جمع بيانات النص الأساسية
          data.groomName = document.getElementById("groomName").value;
          data.weddingHost = document.getElementById("weddingHost").value;
          data.additionalText = document.getElementById("additionalText").value;
          data.weddingDate = document.getElementById("weddingDate").value;
          data.weddingLocation = document.getElementById("weddingLocation").value;
          data.contactInfo = document.getElementById("contactInfo").value;
          data.note = document.getElementById("note").value;

          // جمع بيانات صورة العريس
          const groomPhotoFile = document.getElementById("groomPhoto").files[0];
          if (groomPhotoFile) {
            data.groomPhoto = await fileToBase64(groomPhotoFile);
          }

          // حفظ البيانات في localStorage
          localStorage.setItem("weddingInvitationData", JSON.stringify(data));

          return data;
        } catch (error) {
          console.error("خطأ في حفظ البيانات:", error);
          alert("حدث خطأ في حفظ البيانات");
        }
      }

      // معالجة رفع صورة العريس
      document
        .getElementById("groomPhoto")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const preview = document.getElementById("groomPhotoPreview");
              const img = document.getElementById("groomPhotoPreviewImg");
              img.src = e.target.result;
              preview.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
          }
        });

      // دالة لتوسيع textarea تلقائياً حسب المحتوى
      function autoResizeTextarea(textarea) {
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
      }

      // إعداد التحقق من الحقول
      setupFieldValidation();

      // تحميل البيانات من localStorage إن وجدت
      const data = JSON.parse(localStorage.getItem("weddingInvitationData") || "{}");

      // تحميل البيانات في الحقول
      if (data.groomName) {
        document.getElementById("groomName").value = data.groomName;
      }
      if (data.weddingHost) {
        document.getElementById("weddingHost").value = data.weddingHost;
      }
      if (data.additionalText) {
        document.getElementById("additionalText").value = data.additionalText;
      }
      if (data.weddingDate) {
        document.getElementById("weddingDate").value = data.weddingDate;
      }
      if (data.weddingLocation) {
        document.getElementById("weddingLocation").value = data.weddingLocation;
      }
      if (data.contactInfo) {
        document.getElementById("contactInfo").value = data.contactInfo;
      }
      if (data.note) {
        document.getElementById("note").value = data.note;
      }
      if (data.groomPhoto) {
        const preview = document.getElementById("groomPhotoPreview");
        const img = document.getElementById("groomPhotoPreviewImg");
        img.src = data.groomPhoto;
        preview.classList.remove("hidden");
      }

      // تطبيق auto-resize عند التحميل
      const textareas = document.querySelectorAll('textarea');
      textareas.forEach(textarea => {
        autoResizeTextarea(textarea);
        textarea.addEventListener('input', function() {
          autoResizeTextarea(this);
        });
      });

      // دالة التحقق من صحة البيانات
      function validateForm() {
        let isValid = true;

        // إزالة رسائل الخطأ السابقة
        document.querySelectorAll(".error-message").forEach((error) => {
          error.classList.remove("show");
        });
        document.querySelectorAll(".field-error").forEach((field) => {
          field.classList.remove("field-error");
        });

        // التحقق من صورة العريس
        const groomPhotoFile = document.getElementById("groomPhoto").files[0];
        const existingData = JSON.parse(
          localStorage.getItem("weddingInvitationData") || "{}"
        );
        if (!groomPhotoFile && !existingData.groomPhoto) {
          showError("groomPhoto", "groomPhotoError");
          isValid = false;
        }

        // التحقق من الداعي للزواج
        const weddingHost = document.getElementById("weddingHost").value.trim();
        if (!weddingHost) {
          showError("weddingHost", "weddingHostError");
          isValid = false;
        }

        // التحقق من الاسم
        const groomName = document.getElementById("groomName").value.trim();
        if (!groomName) {
          showError("groomName", "groomNameError");
          isValid = false;
        }

        // التحقق من النص الإضافي
        const additionalText = document.getElementById("additionalText").value.trim();
        if (!additionalText) {
          showError("additionalText", "additionalTextError");
          isValid = false;
        }

        // التحقق من التاريخ
        const weddingDate = document.getElementById("weddingDate").value.trim();
        if (!weddingDate) {
          showError("weddingDate", "weddingDateError");
          isValid = false;
        }

        // التحقق من الموقع
        const weddingLocation = document.getElementById("weddingLocation").value.trim();
        if (!weddingLocation) {
          showError("weddingLocation", "weddingLocationError");
          isValid = false;
        }

        // التحقق من الاستفسار
        const contactInfo = document.getElementById("contactInfo").value.trim();
        if (!contactInfo) {
          showError("contactInfo", "contactInfoError");
          isValid = false;
        }

        // التحقق من الملاحظة
        const note = document.getElementById("note").value.trim();
        if (!note) {
          showError("note", "noteError");
          isValid = false;
        }

        return isValid;
      }

      // دالة لإظهار رسالة الخطأ
      function showError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field) {
          field.classList.add("field-error");
        }
        if (error) {
          error.classList.add("show");
        }
      }

      // إزالة رسالة الخطأ عند الكتابة
      function setupFieldValidation() {
        const textFields = [
          "groomName",
          "weddingHost",
          "additionalText",
          "weddingDate",
          "weddingLocation",
          "contactInfo",
          "note"
        ];

        const fileFields = ["groomPhoto"];

        // معالجة حقول النص
        textFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("input", function () {
              this.classList.remove("field-error");
              const errorId = fieldId + "Error";
              const error = document.getElementById(errorId);
              if (error) {
                error.classList.remove("show");
              }
            });
          }
        });

        // معالجة حقول الملفات
        fileFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("change", function () {
              this.classList.remove("field-error");
              const errorId = fieldId + "Error";
              const error = document.getElementById(errorId);
              if (error) {
                error.classList.remove("show");
              }
            });
          }
        });
      }

      // دالة المعاينة - يمكن استدعاؤها من زر المعاينة
      async function previewTemplate() {
        // التحقق من صحة البيانات أولاً
        if (!validateForm()) {
          // التمرير إلى أول حقل به خطأ
          const firstError = document.querySelector(".field-error");
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          return;
        }

        // إذا كانت البيانات صحيحة، حفظها وفتح المعاينة
        await saveTemplateData();
        generatePreviewContent();
        openPreviewModal();
      }

      // فتح الـ modal
      function openPreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // إغلاق الـ modal
      function closePreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // إغلاق الـ modal عند الضغط خارج المحتوى
      document
        .getElementById("previewModal")
        ?.addEventListener("click", function (e) {
          if (e.target === this) {
            closePreviewModal();
          }
        });

      // إغلاق الـ modal عند الضغط على ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closePreviewModal();
        }
      });

      // توليد محتوى المعاينة
      function generatePreviewContent() {
        const data = JSON.parse(localStorage.getItem("weddingInvitationData") || "{}");
        const previewContainer = document.getElementById(
          "previewTemplateContent"
        );

        // إنشاء HTML للمعاينة
        let html = `
          <div class="space-y-6 text-center">
            ${
              data.groomPhoto
                ? `<div class="flex justify-center mb-4"><img src="${data.groomPhoto}" alt="Groom Photo" class="max-h-64 object-contain rounded-lg" /></div>`
                : ""
            }
            
            <div class="text-center mb-6">
              <h2 class="text-3xl font-bold text-green-800 mb-4">دعوة زواج</h2>
              <div class="text-xl text-gray-700 mb-2 whitespace-pre-line">${data.weddingHost || ""}</div>
            </div>

            <div class="mb-6">
              <p class="text-2xl font-bold text-gray-800 mb-2">${data.groomName || ""}</p>
            </div>

            <div class="mb-6">
              <p class="text-lg text-gray-700 whitespace-pre-line">${data.additionalText || ""}</p>
            </div>

            <div class="mb-6">
              <p class="text-xl font-bold text-green-800 mb-2">التاريخ:</p>
              <p class="text-lg text-gray-700 whitespace-pre-line">${data.weddingDate || ""}</p>
            </div>

            <div class="mb-6">
              <p class="text-xl font-bold text-green-800 mb-2">الموقع:</p>
              <p class="text-lg text-gray-700">${data.weddingLocation || ""}</p>
            </div>

            <div class="mb-6">
              <p class="text-xl font-bold text-green-800 mb-2">للاستفسار:</p>
              <p class="text-lg text-gray-700 whitespace-pre-line">${data.contactInfo || ""}</p>
            </div>

            <div class="mt-8 pt-4 border-t border-gray-300">
              <p class="text-sm text-gray-600 whitespace-pre-line">${data.note || ""}</p>
            </div>
          </div>
        `;

        previewContainer.innerHTML = html;
      }

      // تحميل الصورة من الـ modal
      function downloadImageFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "wedding-invitation.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      // تحميل PDF من الـ modal
      function downloadPDFFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const imgData = canvas.toDataURL("image/jpeg");
          const pdf = new jspdf.jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
          pdf.save("wedding-invitation.pdf");
        });
      }

      function goBack() {
        window.history.back();
      }

      function downloadImage() {
        html2canvas(document.getElementById("template"), {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "wedding-invitation.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      function downloadPDF() {
        html2canvas(document.getElementById("template"), {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const imgData = canvas.toDataURL("image/jpeg");
          const pdf = new jspdf.jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
          pdf.save("wedding-invitation.pdf");
        });
      }
    </script>
  </body>
</html>
