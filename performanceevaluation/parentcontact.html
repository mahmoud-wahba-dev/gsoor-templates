<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <title>تقرير التواصل مع أولياء الأمور | نماذج تعليمية</title>

    <style>
      body {
        font-family: "Helvetica", "Tajawal", sans-serif;
      }
      label {
        font-weight: 600;
        color: #136f3c;
        display: block;
        margin-bottom: 8px;
      }
      
.footer-ink {
        background: #f8fafb;
      }

      .social-icon {
        width: 26px;
        height: 26px;
        fill: currentColor;
      }


      input[type="text"],
      input[type="date"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
        font-size: 14px;
      }
      /* تحسين textarea */
      textarea {
        min-height: 80px;
        line-height: 1.8;
        font-size: 14px;
        padding: 12px;
        resize: vertical;
      }
      input[type="file"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
      }
      /* Toggle Switch Styles */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 26px;
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      .toggle-switch input:checked + .toggle-slider {
        background-color: #10b981;
      }
      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }
      /* Section Background */
      .section-bg {
        background-color: #f3f4f6;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 16px;
      }
      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
      }
      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 90%;
        width: 100%;
        max-width: 1200px;
        position: relative;
        margin: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      .modal-body {
        padding: 20px;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background-color: #f3f4f6;
        color: #111827;
      }
      .preview-template {
        background: white;
        padding: 40px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
      }
      /* Error Message Styles */
      .error-message {
        color: #dc2626;
        font-size: 14px;
        margin-top: 4px;
        display: none;
      }
      .error-message.show {
        display: block;
      }
      .field-error {
        border-color: #dc2626 !important;
        border-width: 2px !important;
      }
      .field-error:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      }
      /* Radio Button Styles */
      .radio-group {
        display: flex;
        gap: 16px;
        margin-top: 8px;
      }
      .radio-option {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .radio-option input[type="radio"] {
        width: 18px;
        height: 18px;
      }
      /* File Upload Styles */
      .file-upload {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }
      .file-upload-btn {
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 8px 16px;
        background-color: #f9fafb;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .file-upload input[type="file"] {
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
      }
      /* Button Styles */
      .btn-main {
        background-color: #10b981;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: bold;
        font-size: 18px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.3s;
      }
      .btn-main:hover {
        background-color: #059669;
      }
    </style>
  </head>

  <body class="bg-gray-100 py-10">
    <div class="max-w-6xl mx-auto">
      <div
        class="max-w-4xl mx-auto border-4 rounded-2xl shadow-xl overflow-hidden mb-8 p-4"
        id="template"
      >
        <div class="bg-white rounded-xl p-6">
          <div
            class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
          >
            <img
              src="https://via.placeholder.com/300x300?text=شعار+التقرير"
              alt="شعار التقرير"
            />
          </div>
          <h1 class="text-5xl text-center">
            تقرير التواصل مع أولياء الأمور
          </h1>
          <p class="text-gray-700 my-4 text-center text-xl">
            إنشاء وتخصيص تقرير التواصل مع أولياء الأمور عبر منصة مدرستي مع إمكانية تحرير وإضافة جميع البيانات الخاصة بك
          </p>
          <div class="p-6 space-y-6">
            <!-- عنوان التقرير -->
            <div>
              <label class="mb-2">عنوان التقرير:</label>
              <input
                type="text"
                id="reportTitle"
                placeholder="تقرير التواصل مع أولياء الأمور (عبر منصة مدرستي)"
                class="w-full"
              />
              <div id="reportTitleError" class="error-message">هذا الحقل مطلوب</div>
            </div>

            <!-- معلومات الهيدر -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">معلومات الهيدر</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="mb-2">البلد:</label>
                  <input
                    type="text"
                    id="country"
                    placeholder="المملكة العربية السعودية"
                    class="w-full"
                  />
                  <div id="countryError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">الوزارة:</label>
                  <input
                    type="text"
                    id="ministry"
                    placeholder="وزارة التعليم"
                    class="w-full"
                  />
                  <div id="ministryError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">الإدارة:</label>
                  <input
                    type="text"
                    id="administration"
                    placeholder="الإدارة العامة للتعليم بالمنطقة الشرقية"
                    class="w-full"
                  />
                  <div id="administrationError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">المدرسة:</label>
                  <input
                    type="text"
                    id="school"
                    placeholder="مدرسة"
                    class="w-full"
                  />
                  <div id="schoolError" class="error-message">هذا الحقل مطلوب</div>
                </div>
              </div>
            </div>

            <!-- معلومات إضافية -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">معلومات إضافية</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="mb-2">العام الدراسي:</label>
                  <input
                    type="text"
                    id="academicYear"
                    placeholder="١٤٤٧هـ"
                    class="w-full"
                  />
                  <div id="academicYearError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">الفصل الدراسي:</label>
                  <input
                    type="text"
                    id="semester"
                    placeholder="الفصل الدراسي الأول"
                    class="w-full"
                  />
                  <div id="semesterError" class="error-message">هذا الحقل مطلوب</div>
                </div>
              </div>
            </div>

            <!-- المعلومات الأساسية -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">المعلومات الأساسية:</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="mb-2">نوع النشاط:</label>
                  <input
                    type="text"
                    id="activityType"
                    placeholder="التواصل عبر منصة مدرستي"
                    class="w-full"
                  />
                  <div id="activityTypeError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">المسؤول عن التواصل:</label>
                  <input
                    type="text"
                    id="responsiblePerson"
                    placeholder="معلم المادة / المرشد الطلابي"
                    class="w-full"
                  />
                  <div id="responsiblePersonError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">الفئة المستهدفة:</label>
                  <input
                    type="text"
                    id="targetGroup"
                    placeholder="أولياء أمور طلاب الصف الثالث"
                    class="w-full"
                  />
                  <div id="targetGroupError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">وسيلة التواصل:</label>
                  <input
                    type="text"
                    id="communicationMethod"
                    placeholder="منصة مدرستي"
                    class="w-full"
                  />
                  <div id="communicationMethodError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">الفترة الزمنية:</label>
                  <input
                    type="text"
                    id="timePeriod"
                    placeholder="الفصل الدراسي الأول"
                    class="w-full"
                  />
                  <div id="timePeriodError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">المجال:</label>
                  <input
                    type="text"
                    id="field"
                    placeholder="متابعة وإرشاد"
                    class="w-full"
                  />
                  <div id="fieldError" class="error-message">هذا الحقل مطلوب</div>
                </div>
              </div>
            </div>

            <!-- الأهداف -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">الأهداف:</h3>
              <div class="space-y-3">
                <div class="flex items-start gap-2">
                  <span class="mt-1">١)</span>
                  <input
                    type="text"
                    id="goal1"
                    placeholder="تعزيز الشراكة الفعالة بين الأسرة والمدرسة"
                    class="w-full"
                  />
                  <div id="goal1Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">٢)</span>
                  <input
                    type="text"
                    id="goal2"
                    placeholder="إبقاء أولياء الأمور على اطلاع دائم بمستوى أبنائهم"
                    class="w-full"
                  />
                  <div id="goal2Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">٣)</span>
                  <input
                    type="text"
                    id="goal3"
                    placeholder="تقديم ملاحظات فورية حول الأداء والسلوك والمواظبة"
                    class="w-full"
                  />
                  <div id="goal3Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">٤)</span>
                  <input
                    type="text"
                    id="goal4"
                    placeholder="تسهيل الرد على استفسارات أولياء الأمور"
                    class="w-full"
                  />
                  <div id="goal4Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">٥)</span>
                  <input
                    type="text"
                    id="goal5"
                    placeholder="إرسال الواجبات والخطط الأسبوعية والإعلانات"
                    class="w-full"
                  />
                  <div id="goal5Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">٦)</span>
                  <input
                    type="text"
                    id="goal6"
                    placeholder="توثيق التواصل الرسمي بشكل منظم عبر المنصة"
                    class="w-full"
                  />
                  <div id="goal6Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
              </div>
              <div class="mt-4">
                <label class="mb-2">حدد أهم الأهداف التي تحققها عملية التواصل:</label>
                <textarea
                  id="mainGoals"
                  class="w-full"
                  placeholder="اكتب أهم الأهداف التي تحققت من خلال التواصل مع أولياء الأمور"
                ></textarea>
                <div id="mainGoalsError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>

            <!-- محاور التواصل الرئيسة -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">محاور التواصل الرئيسة:</h3>
              <div class="space-y-3">
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint1"
                    placeholder="إرسال تقارير الأداء الدراسي"
                    class="w-full"
                  />
                  <div id="communicationPoint1Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint2"
                    placeholder="متابعة الحضور والانصراف والتأخر"
                    class="w-full"
                  />
                  <div id="communicationPoint2Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint3"
                    placeholder="إشعارات بالاختبارات والواجبات المنزلية"
                    class="w-full"
                  />
                  <div id="communicationPoint3Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint4"
                    placeholder="دعوات لاجتماعات أولياء الأمور حضورياً أو عن بُعد"
                    class="w-full"
                  />
                  <div id="communicationPoint4Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint5"
                    placeholder="رسائل إرشادية وتوعوية عامة"
                    class="w-full"
                  />
                  <div id="communicationPoint5Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div class="flex items-start gap-2">
                  <span class="mt-1">•</span>
                  <input
                    type="text"
                    id="communicationPoint6"
                    placeholder="استقبال الملاحظات والاقتراحات والرد عليها"
                    class="w-full"
                  />
                  <div id="communicationPoint6Error" class="error-message">هذا الحقل مطلوب</div>
                </div>
              </div>
              <div class="mt-4">
                <label class="mb-2">اشرح أبرز محاور التواصل التي تمت عبر المنصة:</label>
                <textarea
                  id="communicationExplanation"
                  class="w-full"
                  placeholder="اكتب شرحاً مفصلاً عن أبرز محاور التواصل التي تمت عبر منصة مدرستي"
                ></textarea>
                <div id="communicationExplanationError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>

            <!-- ملاحظات -->
            <div>
              <label class="mb-2">ملاحظات:</label>
              <textarea
                id="notes"
                class="w-full"
                placeholder="أسهم هذا التواصل في رفع مستوى الشراكة بين المدرسة والأسرة، ومتابعة تحصيل الطلاب بشكل دوري وفعّال عبر منصة مدرستي"
              ></textarea>
              <div id="notesError" class="error-message">هذا الحقل مطلوب</div>
            </div>

            <!-- التوقيعات -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">التوقيعات:</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="mb-2">توقيع يمين:</label>
                  <input
                    type="text"
                    id="rightSignature"
                    placeholder="المعلم / اسم المعلم"
                    class="w-full"
                  />
                  <div id="rightSignatureError" class="error-message">هذا الحقل مطلوب</div>
                </div>
                <div>
                  <label class="mb-2">توقيع وسط:</label>
                  <input
                    type="text"
                    id="middleSignature"
                    placeholder=""
                    class="w-full"
                  />
                </div>
                <div>
                  <label class="mb-2">توقيع يسار:</label>
                  <input
                    type="text"
                    id="leftSignature"
                    placeholder=""
                    class="w-full"
                  />
                </div>
              </div>
            </div>

            <!-- تخصيص التصميم -->
            <div class="section-bg">
              <h3 class="text-lg font-bold mb-4">تخصيص التصميم:</h3>
              
              <!-- ستايل النموذج -->
              <div class="mb-4">
                <label class="mb-2">ستايل النموذج:</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="style1" name="templateStyle" value="white" checked>
                    <label for="style1">أبيض (توفير حبر)</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="style2" name="templateStyle" value="original">
                    <label for="style2">الهوية البصرية الأصلية</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="style3" name="templateStyle" value="gradient">
                    <label for="style3">الهوية البصرية تدرج</label>
                  </div>
                </div>
              </div>
              
              <!-- شعار الجهة -->
              <div class="mb-4">
                <label class="mb-2">شعار الجهة:</label>
                <div class="file-upload">
                  <div class="file-upload-btn">
                    <span>شعار وزارة التعليم السعودية</span>
                    <span>No file chosen</span>
                  </div>
                  <input type="file" id="mainLogo" accept="image/*">
                </div>
                <p class="text-gray-600 text-sm mt-2">اختياري - سيظهر شعار وزارة التعليم افتراضياً</p>
              </div>
              
              <!-- الشعار الفرعي -->
              <div class="mb-4">
                <label class="mb-2">الشعار الفرعي:</label>
                <div class="file-upload">
                  <div class="file-upload-btn">
                    <span>الشعار الفرعي</span>
                    <span>No file chosen</span>
                  </div>
                  <input type="file" id="subLogo" accept="image/*">
                </div>
                <p class="text-gray-600 text-sm mt-2">اختياري - يظهر بجانب الشعار الرئيسي</p>
              </div>
              
              <!-- استخدام الأرقام العربية -->
              <div class="mb-4">
                <label class="mb-2">استخدام الأرقام العربية:</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="arabicNumbersOn" name="arabicNumbers" value="on" checked>
                    <label for="arabicNumbersOn">مفعل</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="arabicNumbersOff" name="arabicNumbers" value="off">
                    <label for="arabicNumbersOff">معطل</label>
                  </div>
                </div>
                <p class="text-gray-600 text-sm mt-2">عند الإيقاف تظهر الأرقام كما أدخلت</p>
              </div>
              
              <!-- تصغير الشواهد -->
              <div class="mb-4">
                <label class="mb-2">تصغير الشواهد:</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="smallCertificatesOn" name="smallCertificates" value="on">
                    <label for="smallCertificatesOn">مفعل</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="smallCertificatesOff" name="smallCertificates" value="off" checked>
                    <label for="smallCertificatesOff">معطل</label>
                  </div>
                </div>
                <p class="text-gray-600 text-sm mt-2">4 صور بالصفحة بدلاً من 2</p>
              </div>
              
              <!-- إضافة شواهد (صور) -->
              <div>
                <label class="mb-2">إضافة شواهد (صور):</label>
                <div class="file-upload">
                  <div class="file-upload-btn">
                    <span>إضافة شواهد</span>
                    <span>No file chosen</span>
                  </div>
                  <input type="file" id="certificates" accept="image/*" multiple>
                </div>
                <p class="text-gray-600 text-sm mt-2">أقصى حد للشواهد 10 شواهد</p>
              </div>
            </div>

            <!-- زر المعاينة -->
            <div class="flex justify-center mt-6 mb-8">
              <button
                class="btn-main"
                onclick="previewTemplate()"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="2"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  />
                </svg>
                معاينة التقرير
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

<!-- FOOTER -->
    <footer class="mt-12 footer-ink border-t border-gray-100">
      <div
        class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row md:items-center md:justify-between gap-6"
      >
        <!-- RIGHT COLUMN -->
        <div class="text-right md:flex-1">
          <img
            src="../assets/imgs/gsoor_logo.jpg"
            alt="logo"
            class="h-10 mx-auto md:mx-0"
          />
          <div
            class="flex justify-center md:justify-end gap-4 mt-3 text-gray-600"
          >
            <i class="fa-brands fa-youtube social-icon text-lg"></i>
            <i class="fa-brands fa-tiktok social-icon text-lg"></i>
            <i class="fa-brands fa-instagram social-icon text-lg"></i>
          </div>
        </div>

        <!-- CENTER COLUMN -->
        <div class="text-center md:flex-1">
          <h3 class="font-bold mb-2">تواصل معنا</h3>
          <div class="flex items-center justify-center gap-4 text-gray-600">
            <div class="flex items-center gap-2">
              <i class="fa-regular fa-envelope text-sm"></i>
              <span>البريد</span>
            </div>
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-mobile-screen-button text-sm"></i>
              <span>واتس</span>
            </div>
          </div>
          <div class="mt-3 text-sm text-gray-500">موقّع لدى منصة الأعمال</div>
        </div>

        <!-- LEFT COLUMN -->
        <div class="text-left md:flex-1">
          <div class="text-sm text-gray-500">
            © 2025 متجر جسور الرقمي | جميع الحقوق محفوظة
          </div>
          <div
            class="mt-3 flex gap-2 items-center justify-center md:justify-start"
          >
            <span class="sr-only">Visa</span>
            <i class="fa-brands fa-cc-visa text-gray-600 text-lg"></i>
            <span class="sr-only">Mada</span>
            <i class="fa-solid fa-credit-card text-gray-600 text-lg"></i>
          </div>
        </div>
      </div>
    </footer>
    <!-- Modal Popup للمعاينة -->
    <div id="previewModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="text-2xl font-bold text-gray-800">معاينة تقرير التواصل مع أولياء الأمور</h2>
          <button class="modal-close" onclick="closePreviewModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="previewTemplateContent" class="preview-template">
            <!-- سيتم ملء المحتوى ديناميكياً -->
          </div>
          <div class="flex justify-center gap-4 mt-6">
            <button
              onclick="downloadImageFromModal()"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل كصورة
            </button>
            <button
              onclick="downloadPDFFromModal()"
              class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل PDF
            </button>
            <button
              onclick="closePreviewModal()"
              class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 transition"
            >
              إغلاق
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // دالة مساعدة لتحويل الملف إلى base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // دالة حفظ جميع البيانات في localStorage
      async function saveTemplateData() {
        try {
          // تحميل البيانات الموجودة أولاً للحفاظ على الملفات المحفوظة
          const existingData = JSON.parse(
            localStorage.getItem("parentCommunicationReportData") || "{}"
          );
          const data = { ...existingData };

          // جمع بيانات النص الأساسية
          data.reportTitle = document.getElementById("reportTitle").value;
          data.country = document.getElementById("country").value;
          data.ministry = document.getElementById("ministry").value;
          data.administration = document.getElementById("administration").value;
          data.school = document.getElementById("school").value;
          data.academicYear = document.getElementById("academicYear").value;
          data.semester = document.getElementById("semester").value;
          data.activityType = document.getElementById("activityType").value;
          data.responsiblePerson = document.getElementById("responsiblePerson").value;
          data.targetGroup = document.getElementById("targetGroup").value;
          data.communicationMethod = document.getElementById("communicationMethod").value;
          data.timePeriod = document.getElementById("timePeriod").value;
          data.field = document.getElementById("field").value;
          data.goal1 = document.getElementById("goal1").value;
          data.goal2 = document.getElementById("goal2").value;
          data.goal3 = document.getElementById("goal3").value;
          data.goal4 = document.getElementById("goal4").value;
          data.goal5 = document.getElementById("goal5").value;
          data.goal6 = document.getElementById("goal6").value;
          data.mainGoals = document.getElementById("mainGoals").value;
          data.communicationPoint1 = document.getElementById("communicationPoint1").value;
          data.communicationPoint2 = document.getElementById("communicationPoint2").value;
          data.communicationPoint3 = document.getElementById("communicationPoint3").value;
          data.communicationPoint4 = document.getElementById("communicationPoint4").value;
          data.communicationPoint5 = document.getElementById("communicationPoint5").value;
          data.communicationPoint6 = document.getElementById("communicationPoint6").value;
          data.communicationExplanation = document.getElementById("communicationExplanation").value;
          data.notes = document.getElementById("notes").value;
          data.rightSignature = document.getElementById("rightSignature").value;
          data.middleSignature = document.getElementById("middleSignature").value;
          data.leftSignature = document.getElementById("leftSignature").value;
          
          // جمع بيانات التصميم
          data.templateStyle = document.querySelector('input[name="templateStyle"]:checked').value;
          data.arabicNumbers = document.querySelector('input[name="arabicNumbers"]:checked').value;
          data.smallCertificates = document.querySelector('input[name="smallCertificates"]:checked').value;

          // جمع بيانات الشعارات
          const mainLogoFile = document.getElementById("mainLogo").files[0];
          if (mainLogoFile) {
            data.mainLogo = await fileToBase64(mainLogoFile);
          }
          
          const subLogoFile = document.getElementById("subLogo").files[0];
          if (subLogoFile) {
            data.subLogo = await fileToBase64(subLogoFile);
          }

          // حفظ البيانات في localStorage
          localStorage.setItem("parentCommunicationReportData", JSON.stringify(data));

          return data;
        } catch (error) {
          console.error("خطأ في حفظ البيانات:", error);
          alert("حدث خطأ في حفظ البيانات");
        }
      }

      // دالة التحقق من صحة البيانات
      function validateForm() {
        let isValid = true;

        // إزالة رسائل الخطأ السابقة
        document.querySelectorAll(".error-message").forEach((error) => {
          error.classList.remove("show");
        });
        document.querySelectorAll(".field-error").forEach((field) => {
          field.classList.remove("field-error");
        });

        // قائمة الحقول المطلوبة
        const requiredFields = [
          "reportTitle", "country", "ministry", "administration", "school",
          "academicYear", "semester", "activityType", "responsiblePerson", 
          "targetGroup", "communicationMethod", "timePeriod", "field",
          "goal1", "goal2", "goal3", "goal4", "goal5", "goal6", "mainGoals",
          "communicationPoint1", "communicationPoint2", "communicationPoint3",
          "communicationPoint4", "communicationPoint5", "communicationPoint6",
          "communicationExplanation", "notes", "rightSignature"
        ];

        // التحقق من كل حقل مطلوب
        requiredFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (field && !field.value.trim()) {
            showError(fieldId, fieldId + "Error");
            isValid = false;
          }
        });

        return isValid;
      }

      // دالة لإظهار رسالة الخطأ
      function showError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field) {
          field.classList.add("field-error");
        }
        if (error) {
          error.classList.add("show");
        }
      }

      // إعداد التحقق من الحقول
      function setupFieldValidation() {
        const textFields = [
          "reportTitle", "country", "ministry", "administration", "school",
          "academicYear", "semester", "activityType", "responsiblePerson", 
          "targetGroup", "communicationMethod", "timePeriod", "field",
          "goal1", "goal2", "goal3", "goal4", "goal5", "goal6", "mainGoals",
          "communicationPoint1", "communicationPoint2", "communicationPoint3",
          "communicationPoint4", "communicationPoint5", "communicationPoint6",
          "communicationExplanation", "notes", "rightSignature", "middleSignature", "leftSignature"
        ];

        // معالجة حقول النص
        textFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("input", function () {
              this.classList.remove("field-error");
              const errorId = fieldId + "Error";
              const error = document.getElementById(errorId);
              if (error) {
                error.classList.remove("show");
              }
            });
          }
        });
      }

      // دالة المعاينة
      async function previewTemplate() {
        // التحقق من صحة البيانات أولاً
        if (!validateForm()) {
          // التمرير إلى أول حقل به خطأ
          const firstError = document.querySelector(".field-error");
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
            firstError.focus();
          }
          return;
        }

        // إذا كانت البيانات صحيحة، حفظها وفتح المعاينة
        await saveTemplateData();
        generatePreviewContent();
        openPreviewModal();
      }

      // فتح الـ modal
      function openPreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // إغلاق الـ modal
      function closePreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // إغلاق الـ modal عند الضغط خارج المحتوى
      document
        .getElementById("previewModal")
        ?.addEventListener("click", function (e) {
          if (e.target === this) {
            closePreviewModal();
          }
        });

      // إغلاق الـ modal عند الضغط على ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closePreviewModal();
        }
      });

      // توليد محتوى المعاينة
      function generatePreviewContent() {
        const data = JSON.parse(localStorage.getItem("parentCommunicationReportData") || "{}");
        const previewContainer = document.getElementById(
          "previewTemplateContent"
        );

        // إنشاء HTML للمعاينة
        let html = `
          <div class="space-y-6 text-right">
            <div class="text-center mb-6">
              <h2 class="text-3xl font-bold text-green-800 mb-4">${data.reportTitle || "تقرير التواصل مع أولياء الأمور"}</h2>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">معلومات الهيدر</h3>
              <p class="text-lg text-gray-700">${data.country || ""}</p>
              <p class="text-lg text-gray-700">${data.ministry || ""}</p>
              <p class="text-lg text-gray-700">${data.administration || ""}</p>
              <p class="text-lg text-gray-700">${data.school || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">معلومات إضافية</h3>
              <p class="text-lg text-gray-700">العام الدراسي: ${data.academicYear || ""}</p>
              <p class="text-lg text-gray-700">الفصل الدراسي: ${data.semester || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">المعلومات الأساسية</h3>
              <p class="text-lg text-gray-700">نوع النشاط: ${data.activityType || ""}</p>
              <p class="text-lg text-gray-700">المسؤول عن التواصل: ${data.responsiblePerson || ""}</p>
              <p class="text-lg text-gray-700">الفئة المستهدفة: ${data.targetGroup || ""}</p>
              <p class="text-lg text-gray-700">وسيلة التواصل: ${data.communicationMethod || ""}</p>
              <p class="text-lg text-gray-700">الفترة الزمنية: ${data.timePeriod || ""}</p>
              <p class="text-lg text-gray-700">المجال: ${data.field || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">الأهداف</h3>
              <ul class="list-disc pr-6 text-lg text-gray-700">
                <li>${data.goal1 || ""}</li>
                <li>${data.goal2 || ""}</li>
                <li>${data.goal3 || ""}</li>
                <li>${data.goal4 || ""}</li>
                <li>${data.goal5 || ""}</li>
                <li>${data.goal6 || ""}</li>
              </ul>
              <p class="mt-4 text-lg text-gray-700"><strong>أهم الأهداف المحققة:</strong> ${data.mainGoals || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">محاور التواصل الرئيسة</h3>
              <ul class="list-disc pr-6 text-lg text-gray-700">
                <li>${data.communicationPoint1 || ""}</li>
                <li>${data.communicationPoint2 || ""}</li>
                <li>${data.communicationPoint3 || ""}</li>
                <li>${data.communicationPoint4 || ""}</li>
                <li>${data.communicationPoint5 || ""}</li>
                <li>${data.communicationPoint6 || ""}</li>
              </ul>
              <p class="mt-4 text-lg text-gray-700"><strong>شرح أبرز محاور التواصل:</strong> ${data.communicationExplanation || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">ملاحظات</h3>
              <p class="text-lg text-gray-700">${data.notes || ""}</p>
            </div>

            <div class="mt-8 pt-4 border-t border-gray-300">
              <h3 class="text-xl font-bold text-gray-800 mb-2">التوقيعات</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                  <p class="text-lg text-gray-700">${data.rightSignature || ""}</p>
                  <p class="text-sm text-gray-600 mt-2">توقيع يمين</p>
                </div>
                <div class="text-center">
                  <p class="text-lg text-gray-700">${data.middleSignature || ""}</p>
                  <p class="text-sm text-gray-600 mt-2">توقيع وسط</p>
                </div>
                <div class="text-center">
                  <p class="text-lg text-gray-700">${data.leftSignature || ""}</p>
                  <p class="text-sm text-gray-600 mt-2">توقيع يسار</p>
                </div>
              </div>
            </div>
          </div>
        `;

        previewContainer.innerHTML = html;
      }

      // تحميل الصورة من الـ modal
      function downloadImageFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "parent-communication-report.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      // تحميل PDF من الـ modal
      function downloadPDFFromModal() {
        const previewContent = document.getElementById(
          "previewTemplateContent"
        );
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const imgData = canvas.toDataURL("image/jpeg");
          const pdf = new jspdf.jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
          pdf.save("parent-communication-report.pdf");
        });
      }

      // تهيئة التحقق من الحقول عند تحميل الصفحة
      document.addEventListener('DOMContentLoaded', function() {
        setupFieldValidation();
      });
    </script>
  </body>
</html>
