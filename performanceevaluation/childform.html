<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">

    <title>تقرير اليوم العالمي للطفل | نماذج تعليمية</title>

    <style>
      body {
        font-family: "Helvetica", "Tajawal", sans-serif;
        padding-top: 100px;
      }
      label {
        font-weight: 600;
        color: #136f3c;
        display: block;
        margin-bottom: 8px;
      }
      
.footer-ink {
        background: #f8fafb;
      }

      .social-icon {
        width: 26px;
        height: 26px;
        fill: currentColor;
      }


      input[type="text"],
      input[type="date"],
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
        font-size: 14px;
      }
      /* تحسين textarea */
      textarea {
        min-height: 80px;
        line-height: 1.8;
        font-size: 14px;
        padding: 12px;
        resize: vertical;
      }
      input[type="file"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background-color: #ffffff;
      }
      /* Toggle Switch Styles */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 26px;
      }
      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      .toggle-switch input:checked + .toggle-slider {
        background-color: #10b981;
      }
      .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }
      /* Section Background */
      .section-bg {
        background-color: #f3f4f6;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 16px;
      }
      /* Modal Styles */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
      }
      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .modal-content {
        background: white;
        border-radius: 16px;
        max-width: 90%;
        width: 100%;
        max-width: 1200px;
        position: relative;
        margin: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      .modal-body {
        padding: 20px;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }
      .modal-close {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      .modal-close:hover {
        background-color: #f3f4f6;
        color: #111827;
      }
      .preview-template {
        background: white;
        padding: 40px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
      }
      /* Error Message Styles */
      .error-message {
        color: #dc2626;
        font-size: 14px;
        margin-top: 4px;
        display: none;
      }
      .error-message.show {
        display: block;
      }
      .field-error {
        border-color: #dc2626 !important;
        border-width: 2px !important;
      }
      .field-error:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      }
      /* Radio Button Styles */
      .radio-group {
        display: flex;
        gap: 16px;
        margin-top: 8px;
      }
      .radio-option {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .radio-option input[type="radio"] {
        width: 18px;
        height: 18px;
      }
      /* File Upload Styles */
      .file-upload {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
      }
      .file-upload-btn {
        border: 1px solid #d1d5db;
        border-radius: 6px;
        padding: 8px 16px;
        background-color: #f9fafb;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .file-upload input[type="file"] {
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
      }
      /* Numbered List Styles */
      .numbered-list {
        list-style-type: arabic-indic;
        padding-right: 20px;
      }
      .numbered-list li {
        margin-bottom: 8px;
      }
      /* Button Styles */
      .btn-main {
        background-color: #10b981;
        color: white;
        padding: 16px 32px;
        border-radius: 8px;
        font-weight: bold;
        font-size: 18px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: background-color 0.3s;
        margin: 20px auto;
      }
      .btn-main:hover {
        background-color: #059669;
      }
      .required-field::after {
        content: " *";
        color: #dc2626;
      }
    </style>
  </head>

  <body class="bg-gray-100 py-10">
    <!-- NAVBAR WITHOUT CART -->
<header class="fixed inset-x-0 top-4 z-50 px-4 sm:px-6">
  <div class="max-w-6xl mx-auto relative">
    <div class="nav-pill px-3 py-2 flex items-center justify-between gap-3">
      <!-- LOGO -->
      <div class="flex items-center gap-4 ml-2">
        <a href="#" class="shrink-0">
          <img
            src="../assets/imgs/gsoor_logo.jpg"
            alt="logo"
            class="h-9 w-auto object-contain md:h-10"
          />
        </a>
      </div>

      <!-- NAV LINKS (desktop) -->
      <nav class="hidden md:flex items-center gap-8 text-sm text-gray-700">
        <a href="#" class="hover:text-cyan-600 transition">الشهادات</a>
        <a href="#" class="hover:text-cyan-600 transition">الملفات الإدارية</a>
        <a href="#" class="hover:text-cyan-600 transition">البطاقات</a>
      </nav>

      <!-- UTILITY ICONS WITHOUT CART -->
      <div class="flex items-center gap-2">
        <div class="hidden sm:flex items-center bg-gray-50 rounded-full px-2 py-1 gap-2 border border-gray-100">
          <button id="themeToggle" class="text-gray-600" title="تبديل الوضع">
            <i class="fa-solid fa-moon text-gray-600 text-base"></i>
          </button>
          <button id="profileBtn" class="text-gray-600" title="الحساب">
            <i class="fa-regular fa-user text-gray-600 text-base"></i>
          </button>
        </div>

        <!-- MOBILE MENU BUTTON -->
        <button id="menuBtn" class="md:hidden text-gray-600 p-2" aria-expanded="false">
          <i class="fa-solid fa-bars text-lg"></i>
        </button>
      </div>
    </div>

    <!-- MOBILE NAV WITHOUT CART -->
    <div id="mobileNav" class="hidden mobile-nav-abs mt-2 bg-white rounded-2xl shadow-md p-3 mx-4">
      <div class="flex flex-col gap-2 text-right">
        <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الشهادات</a>
        <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الملفات الإدارية</a>
        <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">البطاقات</a>
        <div class="pt-2 border-t border-gray-100 mt-2 flex justify-between items-center">
          <div class="flex items-center gap-3">
            <button id="mobileThemeToggle" class="text-gray-600">
              <i class="fa-solid fa-moon"></i>
            </button>
          </div>
          <a href="#" class="text-sm text-cyan-600 font-semibold">تسجيل دخول</a>
        </div>
      </div>
    </div>
  </div>
</header>
<script>
  // NAVBAR FUNCTIONALITY WITHOUT CART
  document.addEventListener('DOMContentLoaded', function() {
    const menuBtn = document.getElementById("menuBtn");
    const mobileNav = document.getElementById("mobileNav");
    const mobileThemeToggle = document.getElementById("mobileThemeToggle");

    // Mobile menu toggle
    if (menuBtn) {
      menuBtn.addEventListener("click", (e) => {
        const expanded = menuBtn.getAttribute("aria-expanded") === "true";
        menuBtn.setAttribute("aria-expanded", String(!expanded));
        mobileNav.classList.toggle("hidden");
      });
    }

    // Close mobile menu when clicking outside
    document.addEventListener("click", (e) => {
      if (!mobileNav || mobileNav.classList.contains("hidden")) return;
      const path = e.composedPath?.() || e.path || [];
      if (!path.includes(mobileNav) && !path.includes(menuBtn)) {
        mobileNav.classList.add("hidden");
        if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
      }
    });

    // Close mobile menu on window resize
    window.addEventListener("resize", () => {
      if (window.innerWidth >= 768) {
        mobileNav.classList.add("hidden");
        if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
      }
    });

    // Theme toggle
    document.getElementById("themeToggle")?.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
    });
    
    if (mobileThemeToggle) {
      mobileThemeToggle.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
      });
    }
  });
</script>
    <div class="max-w-6xl mx-auto">
      <div
        class="max-w-4xl mx-auto border-4 rounded-2xl shadow-xl overflow-hidden mb-8 p-4"
        id="template"
      >
        <div class="bg-white rounded-xl p-6">
          <div
            class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
          >
            <img
              src="https://via.placeholder.com/300x300?text=شعار+اليوم+العالمي+للطفل"
              alt="شعار اليوم العالمي للطفل"
            />
          </div>
          <h1 class="text-5xl text-center">
            تقرير اليوم العالمي للطفل
          </h1>
          <p class="text-gray-700 my-4 text-center text-xl">
إنشاء وتخصيص تقرير اليوم العالمي للطفل مع إمكانية تحرير وإضافة جميع البيانات الخاصة بك، بطريقة سهلة واحترافية توفر عليه الوقت والجهد ويتم حفظ الملف النهائي بتنسيق صورة أو ملف pdf لسهولة الطباعة بجودة عالية وإعادة الاستخدام في تقارير ونماذج أخرى.</p>
          
          <!-- الحقول الأساسية المطلوبة -->
          <div>
            <label class="mb-2 required-field">عنوان التقرير:</label>
            <input
              type="text"
              id="reportTitle"
              placeholder="تقرير اليوم العالمي للطفل"
              class="w-full"
            />
            <div id="reportTitleError" class="error-message">هذا الحقل مطلوب</div>
          </div>

          <!-- معلومات الهيدر -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">معلومات الهيدر</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="mb-2 required-field">البلد:</label>
                <input
                  type="text"
                  id="country"
                  placeholder="المملكة العربية السعودية"
                  class="w-full"
                />
                <div id="countryError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">الوزارة:</label>
                <input
                  type="text"
                  id="ministry"
                  placeholder="وزارة التعليم"
                  class="w-full"
                />
                <div id="ministryError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">الإدارة:</label>
                <input
                  type="text"
                  id="administration"
                  placeholder="الإدارة العامة للتعليم بالمنطقة الشرقية"
                  class="w-full"
                />
                <div id="administrationError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">المدرسة:</label>
                <input
                  type="text"
                  id="school"
                  placeholder="مدرسة"
                  class="w-full"
                />
                <div id="schoolError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- معلومات إضافية -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">معلومات إضافية</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="mb-2 required-field">العام الدراسي:</label>
                <input
                  type="text"
                  id="academicYear"
                  placeholder="١٤٤٧هـ"
                  class="w-full"
                />
                <div id="academicYearError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">الفصل الدراسي:</label>
                <input
                  type="text"
                  id="semester"
                  placeholder="الفصل الدراسي الأول"
                  class="w-full"
                />
                <div id="semesterError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- المعلومات الأساسية -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">المعلومات الأساسية:</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="mb-2 required-field">اسم الفعالية:</label>
                <input
                  type="text"
                  id="strategyName"
                  placeholder="اليوم العالمي للطفل"
                  class="w-full"
                />
                <div id="strategyNameError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">عدد المستهدفين:</label>
                <input
                  type="text"
                  id="targetCount"
                  placeholder="٣٠٠"
                  class="w-full"
                />
                <div id="targetCountError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">تاريخ التنفيذ:</label>
                <input
                  type="text"
                  id="executionDate"
                  placeholder="٢٠ نوفمبر ٢٠٢٤"
                  class="w-full"
                />
                <div id="executionDateError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">مكان الفعالية:</label>
                <input
                  type="text"
                  id="initiativeLocation"
                  placeholder="ساحة المدرسة والفصول الدراسية"
                  class="w-full"
                />
                <div id="initiativeLocationError" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div>
                <label class="mb-2 required-field">الفئة المستهدفة:</label>
                <input
                  type="text"
                  id="targetGroup"
                  placeholder="طلاب المرحلة الابتدائية"
                  class="w-full"
                />
                <div id="targetGroupError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- فكرة الفعالية (الهدف العام) -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">فكرة الفعالية (الهدف العام):</h3>
            <textarea
              id="initiativeIdea"
              class="w-full"
              placeholder="تعزيز حقوق الطفل ورفع مستوى الوعي بأهمية رعاية الطفولة وتنمية مهارات الأطفال الإبداعية والاجتماعية"
            ></textarea>
            <div id="initiativeIdeaError" class="error-message">هذا الحقل مطلوب</div>
          </div>

          <!-- الأهداف -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">الأهداف:</h3>
            <div class="space-y-3">
              <div class="flex items-start gap-2">
                <span class="mt-1">①</span>
                <input
                  type="text"
                  id="goal1"
                  placeholder="تعزيز حقوق الطفل الأساسية"
                  class="w-full"
                />
                <div id="goal1Error" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div class="flex items-start gap-2">
                <span class="mt-1">②</span>
                <input
                  type="text"
                  id="goal2"
                  placeholder="تنمية المهارات الإبداعية والاجتماعية للأطفال"
                  class="w-full"
                />
                <div id="goal2Error" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- مكونات الفعالية (آلية التنفيذ) -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">مكونات الفعالية (آلية التنفيذ):</h3>
            <div class="space-y-3">
              <div class="flex items-start gap-2">
                <span class="mt-1">•</span>
                <input
                  type="text"
                  id="component1"
                  placeholder="ورش عمل فنية وإبداعية"
                  class="w-full"
                />
                <div id="component1Error" class="error-message">هذا الحقل مطلوب</div>
              </div>
              <div class="flex items-start gap-2">
                <span class="mt-1">•</span>
                <input
                  type="text"
                  id="component2"
                  placeholder="أنشطة ترفيهية وتعليمية"
                  class="w-full"
                />
                <div id="component2Error" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- التوقيعات -->
          <div class="section-bg">
            <h3 class="text-lg font-bold mb-4">التوقيعات:</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="mb-2 required-field">توقيع المسؤول:</label>
                <input
                  type="text"
                  id="rightSignature"
                  placeholder="المعلم / اسم المعلم"
                  class="w-full"
                />
                <div id="rightSignatureError" class="error-message">هذا الحقل مطلوب</div>
              </div>
            </div>
          </div>

          <!-- زر المعاينة -->
          <div class="flex justify-center mt-6 mb-8">
            <button
              class="btn-main"
              onclick="previewTemplate()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                />
              </svg>
              معاينة التقرير
            </button>
          </div>
        </div>
      </div>
    </div>

<!-- FOOTER -->
    <footer class="mt-12 footer-ink border-t border-gray-100">
      <div
        class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row md:items-center md:justify-between gap-6"
      >
        <!-- RIGHT COLUMN -->
        <div class="text-right md:flex-1">
          <img
            src="../assets/imgs/gsoor_logo.jpg"
            alt="logo"
            class="h-10 mx-auto md:mx-0"
          />
          <div
            class="flex justify-center md:justify-end gap-4 mt-3 text-gray-600"
          >
            <i class="fa-brands fa-youtube social-icon text-lg"></i>
            <i class="fa-brands fa-tiktok social-icon text-lg"></i>
            <i class="fa-brands fa-instagram social-icon text-lg"></i>
          </div>
        </div>

        <!-- CENTER COLUMN -->
        <div class="text-center md:flex-1">
          <h3 class="font-bold mb-2">تواصل معنا</h3>
          <div class="flex items-center justify-center gap-4 text-gray-600">
            <div class="flex items-center gap-2">
              <i class="fa-regular fa-envelope text-sm"></i>
              <span>البريد</span>
            </div>
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-mobile-screen-button text-sm"></i>
              <span>واتس</span>
            </div>
          </div>
          <div class="mt-3 text-sm text-gray-500">موقّع لدى منصة الأعمال</div>
        </div>

        <!-- LEFT COLUMN -->
        <div class="text-left md:flex-1">
          <div class="text-sm text-gray-500">
            © 2025 متجر جسور الرقمي | جميع الحقوق محفوظة
          </div>
          <div
            class="mt-3 flex gap-2 items-center justify-center md:justify-start"
          >
            <span class="sr-only">Visa</span>
            <i class="fa-brands fa-cc-visa text-gray-600 text-lg"></i>
            <span class="sr-only">Mada</span>
            <i class="fa-solid fa-credit-card text-gray-600 text-lg"></i>
          </div>
        </div>
      </div>
    </footer>
    <!-- Modal Popup للمعاينة -->
    <div id="previewModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="text-2xl font-bold text-gray-800">معاينة تقرير اليوم العالمي للطفل</h2>
          <button class="modal-close" onclick="closePreviewModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="previewTemplateContent" class="preview-template">
            <!-- سيتم ملء المحتوى ديناميكياً -->
          </div>
          <div class="flex justify-center gap-4 mt-6">
            <button
              onclick="downloadImageFromModal()"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل كصورة
            </button>
            <button
              onclick="downloadPDFFromModal()"
              class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
                />
              </svg>
              تحميل PDF
            </button>
            <button
              onclick="closePreviewModal()"
              class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 transition"
            >
              إغلاق
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // دالة مساعدة لتحويل الملف إلى base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // دالة حفظ جميع البيانات في localStorage
      async function saveTemplateData() {
        try {
          const existingData = JSON.parse(
            localStorage.getItem("childrensDayReportData") || "{}"
          );
          const data = { ...existingData };

          // جمع بيانات النص الأساسية
          data.reportTitle = document.getElementById("reportTitle").value;
          data.country = document.getElementById("country").value;
          data.ministry = document.getElementById("ministry").value;
          data.administration = document.getElementById("administration").value;
          data.school = document.getElementById("school").value;
          data.academicYear = document.getElementById("academicYear").value;
          data.semester = document.getElementById("semester").value;
          data.strategyName = document.getElementById("strategyName").value;
          data.targetCount = document.getElementById("targetCount").value;
          data.executionDate = document.getElementById("executionDate").value;
          data.initiativeLocation = document.getElementById("initiativeLocation").value;
          data.targetGroup = document.getElementById("targetGroup").value;
          data.initiativeIdea = document.getElementById("initiativeIdea").value;
          data.goal1 = document.getElementById("goal1").value;
          data.goal2 = document.getElementById("goal2").value;
          data.component1 = document.getElementById("component1").value;
          data.component2 = document.getElementById("component2").value;
          data.rightSignature = document.getElementById("rightSignature").value;

          // حفظ البيانات في localStorage
          localStorage.setItem("childrensDayReportData", JSON.stringify(data));
          return data;
        } catch (error) {
          console.error("خطأ في حفظ البيانات:", error);
          alert("حدث خطأ في حفظ البيانات");
        }
      }

      // دالة التحقق من صحة البيانات
      function validateForm() {
        let isValid = true;

        // إزالة رسائل الخطأ السابقة
        document.querySelectorAll(".error-message").forEach((error) => {
          error.classList.remove("show");
        });
        document.querySelectorAll(".field-error").forEach((field) => {
          field.classList.remove("field-error");
        });

        // التحقق من الحقول المطلوبة
        const requiredFields = [
          'reportTitle', 'country', 'ministry', 'administration', 'school',
          'academicYear', 'semester', 'strategyName', 'targetCount', 
          'executionDate', 'initiativeLocation', 'targetGroup', 'initiativeIdea', 
          'goal1', 'goal2', 'component1', 'component2', 'rightSignature'
        ];

        requiredFields.forEach(fieldId => {
          const field = document.getElementById(fieldId);
          if (!field.value.trim()) {
            showError(fieldId, fieldId + 'Error');
            isValid = false;
          }
        });

        return isValid;
      }

      // دالة لإظهار رسالة الخطأ
      function showError(fieldId, errorId) {
        const field = document.getElementById(fieldId);
        const error = document.getElementById(errorId);
        if (field) {
          field.classList.add("field-error");
        }
        if (error) {
          error.classList.add("show");
        }
      }

      // إزالة رسالة الخطأ عند الكتابة
      function setupFieldValidation() {
        const textFields = [
          'reportTitle', 'country', 'ministry', 'administration', 'school',
          'academicYear', 'semester', 'strategyName', 'targetCount', 
          'executionDate', 'initiativeLocation', 'targetGroup', 'initiativeIdea', 
          'goal1', 'goal2', 'component1', 'component2', 'rightSignature'
        ];

        textFields.forEach((fieldId) => {
          const field = document.getElementById(fieldId);
          if (field) {
            field.addEventListener("input", function () {
              this.classList.remove("field-error");
              const errorId = fieldId + "Error";
              const error = document.getElementById(errorId);
              if (error) {
                error.classList.remove("show");
              }
            });
          }
        });
      }

      // دالة المعاينة
      async function previewTemplate() {
        // التحقق من صحة البيانات أولاً
        if (!validateForm()) {
          // التمرير إلى أول حقل به خطأ
          const firstError = document.querySelector(".field-error");
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          return;
        }

        // إذا كانت البيانات صحيحة، حفظها وفتح المعاينة
        await saveTemplateData();
        generatePreviewContent();
        openPreviewModal();
      }

      // فتح الـ modal
      function openPreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      // إغلاق الـ modal
      function closePreviewModal() {
        const modal = document.getElementById("previewModal");
        modal.classList.remove("active");
        document.body.style.overflow = "auto";
      }

      // إغلاق الـ modal عند الضغط خارج المحتوى
      document.getElementById("previewModal")?.addEventListener("click", function (e) {
        if (e.target === this) {
          closePreviewModal();
        }
      });

      // إغلاق الـ modal عند الضغط على ESC
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closePreviewModal();
        }
      });

      // توليد محتوى المعاينة
      function generatePreviewContent() {
        const data = JSON.parse(localStorage.getItem("childrensDayReportData") || "{}");
        const previewContainer = document.getElementById("previewTemplateContent");

        // إنشاء HTML للمعاينة
        let html = `
          <div class="space-y-6 text-right">
            <div class="text-center mb-6">
              <h2 class="text-3xl font-bold text-green-800 mb-4">${data.reportTitle || "تقرير اليوم العالمي للطفل"}</h2>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">معلومات الهيدر</h3>
              <p class="text-lg text-gray-700">${data.country || ""}</p>
              <p class="text-lg text-gray-700">${data.ministry || ""}</p>
              <p class="text-lg text-gray-700">${data.administration || ""}</p>
              <p class="text-lg text-gray-700">${data.school || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">معلومات إضافية</h3>
              <p class="text-lg text-gray-700">العام الدراسي: ${data.academicYear || ""}</p>
              <p class="text-lg text-gray-700">الفصل الدراسي: ${data.semester || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">المعلومات الأساسية</h3>
              <p class="text-lg text-gray-700">اسم الفعالية: ${data.strategyName || ""}</p>
              <p class="text-lg text-gray-700">عدد المستهدفين: ${data.targetCount || ""}</p>
              <p class="text-lg text-gray-700">تاريخ التنفيذ: ${data.executionDate || ""}</p>
              <p class="text-lg text-gray-700">مكان الفعالية: ${data.initiativeLocation || ""}</p>
              <p class="text-lg text-gray-700">الفئة المستهدفة: ${data.targetGroup || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">فكرة الفعالية (الهدف العام)</h3>
              <p class="text-lg text-gray-700">${data.initiativeIdea || ""}</p>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">الأهداف</h3>
              <ul class="numbered-list text-lg text-gray-700">
                <li>${data.goal1 || ""}</li>
                <li>${data.goal2 || ""}</li>
              </ul>
            </div>

            <div class="mb-6">
              <h3 class="text-xl font-bold text-gray-800 mb-2">مكونات الفعالية (آلية التنفيذ)</h3>
              <ul class="list-disc pr-6 text-lg text-gray-700">
                <li>${data.component1 || ""}</li>
                <li>${data.component2 || ""}</li>
              </ul>
            </div>

            <div class="mt-8 pt-4 border-t border-gray-300">
              <h3 class="text-xl font-bold text-gray-800 mb-2">التوقيعات</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                  <p class="text-lg text-gray-700">${data.rightSignature || ""}</p>
                  <p class="text-sm text-gray-600 mt-2">توقيع المسؤول</p>
                </div>
              </div>
            </div>
          </div>
        `;

        previewContainer.innerHTML = html;
      }

      // تحميل الصورة من الـ modal
      function downloadImageFromModal() {
        const previewContent = document.getElementById("previewTemplateContent");
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "childrens-day-report.png";
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      // تحميل PDF من الـ modal
      function downloadPDFFromModal() {
        const previewContent = document.getElementById("previewTemplateContent");
        html2canvas(previewContent, {
          backgroundColor: "#ffffff",
          scale: 2,
        }).then((canvas) => {
          const imgData = canvas.toDataURL("image/jpeg");
          const pdf = new jspdf.jsPDF("p", "mm", "a4");
          const imgWidth = 210;
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
          pdf.save("childrens-day-report.pdf");
        });
      }

      // تهيئة التحقق من الصحة عند تحميل الصفحة
      document.addEventListener('DOMContentLoaded', function() {
        setupFieldValidation();
        
        // تحميل البيانات المحفوظة إن وجدت
        const savedData = JSON.parse(localStorage.getItem("childrensDayReportData") || "{}");
        Object.keys(savedData).forEach(key => {
          const element = document.getElementById(key);
          if (element && savedData[key]) {
            element.value = savedData[key];
          }
        });
      });
    </script>
  </body>
</html>
