<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>أفضل نموذج لتوثيق برنامج أو نشاط</title>

  <!-- Add html2canvas and jsPDF libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer">

  <style>
    :root {
      --bg: #f5f6f7;
      --card: #ffffff;
      --accent: #2AA44F;
      --muted: #777;
      --border: #d6d6d6;
      --input: #fafafa;
      --error: #dc2626;
    }


    .footer-ink {
      background: #f8fafb;
    }

    .social-icon {
      width: 26px;
      height: 26px;
      fill: currentColor;
    }



    * {
      box-sizing: border-box;
      font-family: "Tahoma", Arial, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #222;
      padding-top:100px;
    }

    /* Top gray info box */
    .support-box {
      background: #fff;
      border: 1px solid var(--border);
      padding: 18px;
      margin: 25px auto;
      max-width: 1000px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
    }

    .support-box button {
      margin: 6px;
      padding: 10px 22px;
      border-radius: 6px;
      cursor: pointer;
      border: 0;
      font-weight: bold;
      color: #fff;
    }

    .btn-twitter {
      background: #1d9bf0;
    }

    .btn-telegram {
      background: #0088cc;
    }

    /* Main card */
    .container {
      max-width: 850px;
      margin: 20px auto 30px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 25px 32px;
    }

    .header-img {
      text-align: center;
      margin-bottom: 15px;
    }

    .header-img img {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin-top: 5px;
      font-size: 22px;
      text-align: center;
      font-weight: 700;
    }

    .subtext {
      text-align: center;
      margin: 8px auto 25px;
      color: #666;
      font-size: 14px;
      line-height: 1.7;
      max-width: 650px;
    }

    /* Form layout */
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 5px;
      font-weight: 600;
    }

    input[type=text],
    input[type=date],
    input[type=file],
    textarea,
    select {
      width: 100%;
      padding: 9px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      background: var(--input);
    }

    textarea {
      min-height: 95px;
      resize: vertical;
    }

    .row {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .col {
      flex: 1;
    }

    .section-title {
      margin: 20px 0 8px;
      font-weight: 700;
      font-size: 15px;
    }

    /* Buttons */
    .actions {
      text-align: center;
      margin-top: 20px;
    }

    .btn-main {
      background: var(--accent);
      padding: 12px 30px;
      border: 0;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      color: #fff;
      font-weight: bold;
    }

    .btn-reset {
      background: #fff;
      border: 1px solid var(--border);
      padding: 12px 22px;
      border-radius: 6px;
      margin-right: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    /* Footer link boxes */
    .footer-links {
      text-align: center;
      margin: 25px 0 10px;
    }

    .footer-links a {
      display: inline-block;
      padding: 7px 18px;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin: 3px;
      font-size: 14px;
      text-decoration: none;
      color: #222;
      background: #fdfdfd;
    }

    /* Stats */
    .stats-box {
      text-align: center;
      margin: 18px 0;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #fff;
    }

    .stats-box strong {
      font-size: 17px;
    }

    /* Bottom footer */
    footer {
      text-align: center;
      font-size: 13px;
      color: #777;
      padding: 20px 0;
    }

    footer a {
      color: #777;
      text-decoration: none;
      margin: 0 4px;
    }

    /* Error Styles */
    .error-message {
      color: var(--error);
      font-size: 12px;
      margin-top: 4px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .field-error {
      border-color: var(--error) !important;
      border-width: 2px !important;
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 90%;
      width: 100%;
      max-width: 800px;
      position: relative;
      margin: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
    }

    .modal-body {
      padding: 20px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background-color: #f3f4f6;
      color: #111827;
    }

    .preview-template {
      background: white;
      padding: 30px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
    }

    /* Download Buttons */
    .download-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn-download {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .btn-download-pdf {
      background: #dc2626;
      color: white;
    }

    .btn-download-pdf:hover {
      background: #b91c1c;
    }

    .btn-download-image {
      background: #2563eb;
      color: white;
    }

    .btn-download-image:hover {
      background: #1d4ed8;
    }

    .btn-close {
      background: #6b7280;
      color: white;
    }

    .btn-close:hover {
      background: #4b5563;
    }

    @media(max-width:720px) {
      .row {
        flex-direction: column
      }

      .container {
        padding: 22px;
      }

      .download-buttons {
        flex-direction: column;
        align-items: center;
      }

      .btn-download {
        width: 200px;
        justify-content: center;
      }
    }
  </style>

</head>

<body>

  <!-- NAVBAR WITHOUT CART -->
  <header class="fixed inset-x-0 top-4 z-50 px-4 sm:px-6">
    <div class="max-w-6xl mx-auto relative">
      <div class="nav-pill px-3 py-2 flex items-center justify-between gap-3">
        <!-- LOGO -->
        <div class="flex items-center gap-4 ml-2">
          <a href="#" class="shrink-0">
            <img src="../assets/imgs/gsoor_logo.jpg" alt="logo" class="h-9 w-auto object-contain md:h-10" />
          </a>
        </div>

        <!-- NAV LINKS (desktop) -->
        <nav class="hidden md:flex items-center gap-8 text-sm text-gray-700">
          <a href="#" class="hover:text-cyan-600 transition">الشهادات</a>
          <a href="#" class="hover:text-cyan-600 transition">الملفات الإدارية</a>
          <a href="#" class="hover:text-cyan-600 transition">البطاقات</a>
        </nav>

        <!-- UTILITY ICONS WITHOUT CART -->
        <div class="flex items-center gap-2">
          <div class="hidden sm:flex items-center bg-gray-50 rounded-full px-2 py-1 gap-2 border border-gray-100">
            <button id="themeToggle" class="text-gray-600" title="تبديل الوضع">
              <i class="fa-solid fa-moon text-gray-600 text-base"></i>
            </button>
            <button id="profileBtn" class="text-gray-600" title="الحساب">
              <i class="fa-regular fa-user text-gray-600 text-base"></i>
            </button>
          </div>

          <!-- MOBILE MENU BUTTON -->
          <button id="menuBtn" class="md:hidden text-gray-600 p-2" aria-expanded="false">
            <i class="fa-solid fa-bars text-lg"></i>
          </button>
        </div>
      </div>

      <!-- MOBILE NAV WITHOUT CART -->
      <div id="mobileNav" class="hidden mobile-nav-abs mt-2 bg-white rounded-2xl shadow-md p-3 mx-4">
        <div class="flex flex-col gap-2 text-right">
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الشهادات</a>
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الملفات الإدارية</a>
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">البطاقات</a>
          <div class="pt-2 border-t border-gray-100 mt-2 flex justify-between items-center">
            <div class="flex items-center gap-3">
              <button id="mobileThemeToggle" class="text-gray-600">
                <i class="fa-solid fa-moon"></i>
              </button>
            </div>
            <a href="#" class="text-sm text-cyan-600 font-semibold">تسجيل دخول</a>
          </div>
        </div>
      </div>
    </div>
  </header>
  <script>
    // NAVBAR FUNCTIONALITY WITHOUT CART
    document.addEventListener('DOMContentLoaded', function () {
      const menuBtn = document.getElementById("menuBtn");
      const mobileNav = document.getElementById("mobileNav");
      const mobileThemeToggle = document.getElementById("mobileThemeToggle");

      // Mobile menu toggle
      if (menuBtn) {
        menuBtn.addEventListener("click", (e) => {
          const expanded = menuBtn.getAttribute("aria-expanded") === "true";
          menuBtn.setAttribute("aria-expanded", String(!expanded));
          mobileNav.classList.toggle("hidden");
        });
      }

      // Close mobile menu when clicking outside
      document.addEventListener("click", (e) => {
        if (!mobileNav || mobileNav.classList.contains("hidden")) return;
        const path = e.composedPath?.() || e.path || [];
        if (!path.includes(mobileNav) && !path.includes(menuBtn)) {
          mobileNav.classList.add("hidden");
          if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
        }
      });

      // Close mobile menu on window resize
      window.addEventListener("resize", () => {
        if (window.innerWidth >= 768) {
          mobileNav.classList.add("hidden");
          if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
        }
      });

      // Theme toggle
      document.getElementById("themeToggle")?.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
      });

      if (mobileThemeToggle) {
        mobileThemeToggle.addEventListener("click", () => {
          document.documentElement.classList.toggle("dark");
        });
      }
    });
  </script>
  <!-- Main content card -->
  <div class="container">

    <div class="header-img">
      <img src="/mnt/data/Screenshot_26-11-2025_14758_edu-forms.com.jpeg">
    </div>

    <h1>أفضل نموذج لتوثيق برنامج أو نشاط (المطوع)</h1>

    <p class="subtext">
      نموذج توثيق برنامج أو نشاط يقبل رفع شاهد واحد فقط بصورة كفد أدنى وصورتين كحد أقصى،
      إمكانية وضع رابط للشواهد وسيتم تحويله لباركود تلقائياً بهذه الصفحة.
      يمكنك وضع عدد لا نهائي من الشواهد.
    </p>

    <form id="programForm">

      <div class="row">
        <div class="col">
          <label>إدارة التعليم / اسم المدرسة:</label>
          <input type="text" id="educationDept" placeholder="الإدارة العامة للتعليم">
          <div id="educationDeptError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>اسم البرنامج / المبادرة:</label>
          <input type="text" id="programName">
          <div id="programNameError" class="error-message">هذا الحقل مطلوب</div>
        </div>
        <div class="col">
          <label>المنفذون:</label>
          <input type="text" id="implementers">
          <div id="implementersError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>المشارك/ون:</label>
          <input type="text" id="participants">
          <div id="participantsError" class="error-message">هذا الحقل مطلوب</div>
        </div>
        <div class="col">
          <label>المستفيدون / عددهم:</label>
          <input type="text" id="beneficiaries">
          <div id="beneficiariesError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>المجال:</label>
          <input type="text" id="field">
          <div id="fieldError" class="error-message">هذا الحقل مطلوب</div>
        </div>
        <div class="col">
          <label>مكان التنفيذ:</label>
          <input type="text" id="location">
          <div id="locationError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>مدة التنفيذ:</label>
          <input type="text" id="duration">
          <div id="durationError" class="error-message">هذا الحقل مطلوب</div>
        </div>
        <div class="col">
          <label>تاريخ التنفيذ:</label>
          <input type="date" id="executionDate">
          <div id="executionDateError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="section-title">الأهداف:</div>
      <textarea id="objectives"></textarea>
      <div id="objectivesError" class="error-message">هذا الحقل مطلوب</div>

      <div class="section-title">خطوات التنفيذ / الوصف:</div>
      <textarea id="description"></textarea>
      <div id="descriptionError" class="error-message">هذا الحقل مطلوب</div>

      <div class="row">
        <div class="col">
          <label>وظيفة واسم التوقيع الأيمن:</label>
          <input type="text" id="rightSignature">
          <div id="rightSignatureError" class="error-message">هذا الحقل مطلوب</div>
        </div>
        <div class="col">
          <label>وظيفة واسم التوقيع الأيسر:</label>
          <input type="text" id="leftSignature">
          <div id="leftSignatureError" class="error-message">هذا الحقل مطلوب</div>
        </div>
      </div>

      <div class="section-title">صورة الشاهد الأول:</div>
      <input type="file" id="witness1" accept="image/*">
      <div id="witness1Error" class="error-message">هذا الحقل مطلوب (يجب رفع شاهد واحد على الأقل)</div>

      <div class="section-title" style="margin-top:15px">صورة الشاهد الثاني:</div>
      <input type="file" id="witness2" accept="image/*">

      <div class="section-title" style="margin-top:20px">ضع رابط الشواهد إن وجد لإنشاء باركود ووضعه بالنموذج:</div>
      <input type="text" id="evidenceLink">

      <div class="actions">
        <button type="button" class="btn-main" id="previewBtn">معاينة</button>
      </div>
    </form>

    <div class="footer-links">
      <a href="#">أفضل نموذج لتوثيق برنامج أو نشاط (المطوع)</a>
      <a href="#">نموذج تنفيذ استراتيجية متقدمة</a>
      <a href="#">تقرير جاهز لليوم العالمي للتغذية الصحية</a>
      <a href="#">خطط علاجية وإثرائية</a>
    </div>

  </div>

  <!-- Modal Popup للمعاينة -->
  <div id="previewModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-2xl font-bold text-gray-800">معاينة نموذج التوثيق</h2>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="previewTemplateContent" class="preview-template">
          <!-- سيتم ملء المحتوى ديناميكياً -->
        </div>
        <div class="download-buttons">
          <button onclick="downloadImageFromModal()" class="btn-download btn-download-image">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
              <path
                d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
            </svg>
            تحميل كصورة
          </button>
          <button onclick="downloadPDFFromModal()" class="btn-download btn-download-pdf">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
              <path
                d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
            </svg>
            تحميل PDF
          </button>
          <button onclick="closePreviewModal()" class="btn-download btn-close">
            إغلاق
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-12 footer-ink border-t border-gray-100">
    <div class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row md:items-center md:justify-between gap-6">
      <!-- RIGHT COLUMN -->
      <div class="text-right md:flex-1">
        <img src="../assets/imgs/gsoor_logo.jpg" alt="logo" class="h-10 mx-auto md:mx-0" />
        <div class="flex justify-center md:justify-end gap-4 mt-3 text-gray-600">
          <i class="fa-brands fa-youtube social-icon text-lg"></i>
          <i class="fa-brands fa-tiktok social-icon text-lg"></i>
          <i class="fa-brands fa-instagram social-icon text-lg"></i>
        </div>
      </div>

      <!-- CENTER COLUMN -->
      <div class="text-center md:flex-1">
        <h3 class="font-bold mb-2">تواصل معنا</h3>
        <div class="flex items-center justify-center gap-4 text-gray-600">
          <div class="flex items-center gap-2">
            <i class="fa-regular fa-envelope text-sm"></i>
            <span>البريد</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-mobile-screen-button text-sm"></i>
            <span>واتس</span>
          </div>
        </div>
        <div class="mt-3 text-sm text-gray-500">موقّع لدى منصة الأعمال</div>
      </div>

      <!-- LEFT COLUMN -->
      <div class="text-left md:flex-1">
        <div class="text-sm text-gray-500">
          © 2025 متجر جسور الرقمي | جميع الحقوق محفوظة
        </div>
        <div class="mt-3 flex gap-2 items-center justify-center md:justify-start">
          <span class="sr-only">Visa</span>
          <i class="fa-brands fa-cc-visa text-gray-600 text-lg"></i>
          <span class="sr-only">Mada</span>
          <i class="fa-solid fa-credit-card text-gray-600 text-lg"></i>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // تهيئة التحقق من الحقول
    function setupFieldValidation() {
      const textFields = [
        'educationDept', 'programName', 'implementers', 'participants',
        'beneficiaries', 'field', 'location', 'duration', 'executionDate',
        'objectives', 'description', 'rightSignature', 'leftSignature'
      ];

      // معالجة حقول النص
      textFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function () {
            this.classList.remove('field-error');
            const errorId = fieldId + 'Error';
            const error = document.getElementById(errorId);
            if (error) {
              error.classList.remove('show');
            }
          });
        }
      });

      // معالجة حقول الملفات
      const fileFields = ['witness1', 'witness2'];
      fileFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('change', function () {
            this.classList.remove('field-error');
            const errorId = fieldId + 'Error';
            const error = document.getElementById(errorId);
            if (error) {
              error.classList.remove('show');
            }
          });
        }
      });
    }

    // دالة التحقق من صحة البيانات
    function validateForm() {
      let isValid = true;

      // إزالة رسائل الخطأ السابقة
      document.querySelectorAll('.error-message').forEach(error => {
        error.classList.remove('show');
      });
      document.querySelectorAll('.field-error').forEach(field => {
        field.classList.remove('field-error');
      });

      // التحقق من الحقول النصية المطلوبة
      const requiredFields = [
        'educationDept', 'programName', 'implementers', 'participants',
        'beneficiaries', 'field', 'location', 'duration', 'executionDate',
        'objectives', 'description', 'rightSignature', 'leftSignature'
      ];

      requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && !field.value.trim()) {
          showError(fieldId, fieldId + 'Error');
          isValid = false;
        }
      });

      // التحقق من صورة الشاهد الأول (مطلوب على الأقل شاهد واحد)
      const witness1 = document.getElementById('witness1').files[0];
      if (!witness1) {
        showError('witness1', 'witness1Error');
        isValid = false;
      }

      return isValid;
    }

    // دالة لإظهار رسالة الخطأ
    function showError(fieldId, errorId) {
      const field = document.getElementById(fieldId);
      const error = document.getElementById(errorId);
      if (field) {
        field.classList.add('field-error');
      }
      if (error) {
        error.classList.add('show');
      }
    }

    // دالة حفظ البيانات
    function saveFormData() {
      const formData = {
        educationDept: document.getElementById('educationDept').value,
        programName: document.getElementById('programName').value,
        implementers: document.getElementById('implementers').value,
        participants: document.getElementById('participants').value,
        beneficiaries: document.getElementById('beneficiaries').value,
        field: document.getElementById('field').value,
        location: document.getElementById('location').value,
        duration: document.getElementById('duration').value,
        executionDate: document.getElementById('executionDate').value,
        objectives: document.getElementById('objectives').value,
        description: document.getElementById('description').value,
        rightSignature: document.getElementById('rightSignature').value,
        leftSignature: document.getElementById('leftSignature').value,
        evidenceLink: document.getElementById('evidenceLink').value
      };

      localStorage.setItem('programDocumentationData', JSON.stringify(formData));
      return formData;
    }

    // دالة توليد محتوى المعاينة
    function generatePreviewContent() {
      const data = JSON.parse(localStorage.getItem('programDocumentationData') || '{}');
      const previewContainer = document.getElementById('previewTemplateContent');

      let html = `
        <div class="space-y-6 text-right" id="previewContent">
          <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-green-800 mb-4">نموذج توثيق برنامج / نشاط</h2>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div><strong>إدارة التعليم / اسم المدرسة:</strong> ${data.educationDept || ''}</div>
            <div><strong>اسم البرنامج / المبادرة:</strong> ${data.programName || ''}</div>
            <div><strong>المنفذون:</strong> ${data.implementers || ''}</div>
            <div><strong>المشارك/ون:</strong> ${data.participants || ''}</div>
            <div><strong>المستفيدون / عددهم:</strong> ${data.beneficiaries || ''}</div>
            <div><strong>المجال:</strong> ${data.field || ''}</div>
            <div><strong>مكان التنفيذ:</strong> ${data.location || ''}</div>
            <div><strong>مدة التنفيذ:</strong> ${data.duration || ''}</div>
            <div><strong>تاريخ التنفيذ:</strong> ${data.executionDate || ''}</div>
          </div>

          <div>
            <strong>الأهداف:</strong>
            <p class="mt-2 p-3 bg-gray-50 rounded whitespace-pre-line">${data.objectives || ''}</p>
          </div>

          <div>
            <strong>خطوات التنفيذ / الوصف:</strong>
            <p class="mt-2 p-3 bg-gray-50 rounded whitespace-pre-line">${data.description || ''}</p>
          </div>

          <div class="grid grid-cols-2 gap-4 mt-6">
            <div>
              <strong>وظيفة واسم التوقيع الأيمن:</strong>
              <p>${data.rightSignature || ''}</p>
            </div>
            <div>
              <strong>وظيفة واسم التوقيع الأيسر:</strong>
              <p>${data.leftSignature || ''}</p>
            </div>
          </div>

          ${data.evidenceLink ? `
            <div class="mt-6">
              <strong>رابط الشواهد:</strong>
              <p class="text-blue-600 break-all">${data.evidenceLink}</p>
            </div>
          ` : ''}
        </div>
      `;

      previewContainer.innerHTML = html;
    }

    // فتح الـ modal
    function openPreviewModal() {
      const modal = document.getElementById('previewModal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // إغلاق الـ modal
    function closePreviewModal() {
      const modal = document.getElementById('previewModal');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // تحميل الصورة من الـ modal
    function downloadImageFromModal() {
      const previewContent = document.getElementById('previewTemplateContent');

      // إظهار رسالة تحميل
      const downloadBtn = event.target;
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = 'جاري التحميل...';
      downloadBtn.disabled = true;

      html2canvas(previewContent, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        logging: false
      }).then((canvas) => {
        const link = document.createElement('a');
        link.download = `نموذج-توثيق-برنامج-${new Date().toLocaleDateString('ar-SA')}.png`;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();

        // إعادة زر التحميل إلى حالته الأصلية
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }).catch(error => {
        console.error('Error generating image:', error);
        alert('حدث خطأ أثناء تحميل الصورة');
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      });
    }

    // تحميل PDF من الـ modal
    function downloadPDFFromModal() {
      const previewContent = document.getElementById('previewTemplateContent');

      // إظهار رسالة تحميل
      const downloadBtn = event.target;
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = 'جاري التحميل...';
      downloadBtn.disabled = true;

      html2canvas(previewContent, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true,
        logging: false
      }).then((canvas) => {
        const imgData = canvas.toDataURL('image/jpeg', 0.9);
        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        const imgWidth = 190; // عرض أقل بقليل من A4 للحواف
        const pageHeight = 280;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        let heightLeft = imgHeight;
        let position = 10;

        // الصفحة الأولى
        pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        // إضافة صفحات إضافية إذا كان المحتوى طويلاً
        while (heightLeft >= 0) {
          position = heightLeft - imgHeight + 10;
          pdf.addPage();
          pdf.addImage(imgData, 'JPEG', 10, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }

        pdf.save(`نموذج-توثيق-برنامج-${new Date().toLocaleDateString('ar-SA')}.pdf`);

        // إعادة زر التحميل إلى حالته الأصلية
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }).catch(error => {
        console.error('Error generating PDF:', error);
        alert('حدث خطأ أثناء تحميل PDF');
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      });
    }

    // دالة المعاينة الرئيسية
    function previewTemplate() {
      // التحقق من صحة البيانات أولاً
      if (!validateForm()) {
        // التمرير إلى أول حقل به خطأ
        const firstError = document.querySelector('.field-error');
        if (firstError) {
          firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }

      // إذا كانت البيانات صحيحة، حفظها وفتح المعاينة
      saveFormData();
      generatePreviewContent();
      openPreviewModal();
    }

    // تهيئة الأحداث عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', function () {
      // تهيئة التحقق من الحقول
      setupFieldValidation();

      // ربط زر المعاينة
      document.getElementById('previewBtn').addEventListener('click', previewTemplate);

      // ربط زر إغلاق الـ modal
      document.getElementById('closeModal').addEventListener('click', closePreviewModal);

      // إغلاق الـ modal عند الضغط خارج المحتوى
      document.getElementById('previewModal').addEventListener('click', function (e) {
        if (e.target === this) {
          closePreviewModal();
        }
      });

      // إغلاق الـ modal عند الضغط على ESC
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
          closePreviewModal();
        }
      });

      // تحميل البيانات المحفوظة إن وجدت
      const savedData = JSON.parse(localStorage.getItem('programDocumentationData') || '{}');
      Object.keys(savedData).forEach(key => {
        const field = document.getElementById(key);
        if (field) {
          field.value = savedData[key];
        }
      });
    });
  </script>

</body>

</html>
