<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer">

  <title>غلاف لأي تقرير أو ملف بالعرض (أفقي) - جاهز للتحميل والطباعة</title>
  <style>
    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }

  body{
    padding-top: 100px;
  }
    .footer-ink {
      background: #f8fafb;
    }

    .social-icon {
      width: 26px;
      height: 26px;
      fill: currentColor;
    }


    .modal-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 90%;
      width: 100%;
      max-width: 1200px;
      position: relative;
      margin: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
    }

    .modal-body {
      padding: 20px;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background-color: #f3f4f6;
      color: #111827;
    }

    .preview-template {
      background: white;
      padding: 40px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
    }

    .error-message {
      color: #dc2626;
      font-size: 14px;
      margin-top: 4px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    .field-error {
      border-color: #dc2626 !important;
      border-width: 2px !important;
    }

    .field-error:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }

    /* Navbar Styles */
    .navbar {
      background-color: #f3f4f6;
      padding: 12px 0;
      border-bottom: 1px solid #e5e7eb;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      width: 100%;
      margin: 0;
    }

    .navbar-container {
      width: 100%;
      margin: 0;
      padding: 0 16px;
    }

    .navbar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .navbar-title {
      font-size: 16px;
      font-weight: 600;
      color: #374151;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .navbar-icon {
      width: 20px;
      height: 20px;
      color: #3b82f6;
      flex-shrink: 0;
    }

    .navbar-menu {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px 12px;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .navbar-item {
      position: relative;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .navbar-link {
      color: #374151;
      text-decoration: none;
      font-size: 18px;
      padding: 4px 6px;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: color 0.2s;
      white-space: nowrap;
    }

    .navbar-link:hover {
      color: #111827;
    }

    .dropdown-icon {
      width: 10px;
      height: 10px;
      color: #374151;
      margin-right: 4px;
    }

    .navbar-separator {
      color: #9ca3af;
      margin: 0 4px;
    }

    /* Mobile Menu Toggle */
    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      color: #374151;
      cursor: pointer;
      padding: 8px;
    }

    .mobile-menu {
      display: none;
      flex-direction: column;
      gap: 8px;
      padding: 12px 0;
      border-top: 1px solid #e5e7eb;
      margin-top: 8px;
    }

    .mobile-menu.active {
      display: flex;
    }

    /* Responsive Styles */
    @media (max-width: 1200px) {
      .navbar-menu {
        gap: 6px 12px;
      }

      .navbar-link {
        font-size: 13px;
        padding: 5px 6px;
      }
    }

    @media (max-width: 768px) {
      .navbar-container {
        padding: 0 12px;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .navbar-menu {
        display: none;
      }

      .navbar-menu.mobile-active {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        padding: 12px 0;
      }

      .navbar-item {
        width: 100%;
      }

      .navbar-link {
        width: 100%;
        padding: 10px 8px;
      }

      .navbar-separator {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- NAVBAR WITHOUT CART -->
  <header class="fixed inset-x-0 top-4 z-50 px-4 sm:px-6">
    <div class="max-w-6xl mx-auto relative">
      <div class="nav-pill px-3 py-2 flex items-center justify-between gap-3">
        <!-- LOGO -->
        <div class="flex items-center gap-4 ml-2">
          <a href="#" class="shrink-0">
            <img src="../assets/imgs/gsoor_logo.jpg" alt="logo" class="h-9 w-auto object-contain md:h-10" />
          </a>
        </div>

        <!-- NAV LINKS (desktop) -->
        <nav class="hidden md:flex items-center gap-8 text-sm text-gray-700">
          <a href="#" class="hover:text-cyan-600 transition">الشهادات</a>
          <a href="#" class="hover:text-cyan-600 transition">الملفات الإدارية</a>
          <a href="#" class="hover:text-cyan-600 transition">البطاقات</a>
        </nav>

        <!-- UTILITY ICONS WITHOUT CART -->
        <div class="flex items-center gap-2">
          <div class="hidden sm:flex items-center bg-gray-50 rounded-full px-2 py-1 gap-2 border border-gray-100">
            <button id="themeToggle" class="text-gray-600" title="تبديل الوضع">
              <i class="fa-solid fa-moon text-gray-600 text-base"></i>
            </button>
            <button id="profileBtn" class="text-gray-600" title="الحساب">
              <i class="fa-regular fa-user text-gray-600 text-base"></i>
            </button>
          </div>

          <!-- MOBILE MENU BUTTON -->
          <button id="menuBtn" class="md:hidden text-gray-600 p-2" aria-expanded="false">
            <i class="fa-solid fa-bars text-lg"></i>
          </button>
        </div>
      </div>

      <!-- MOBILE NAV WITHOUT CART -->
      <div id="mobileNav" class="hidden mobile-nav-abs mt-2 bg-white rounded-2xl shadow-md p-3 mx-4">
        <div class="flex flex-col gap-2 text-right">
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الشهادات</a>
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">الملفات الإدارية</a>
          <a href="#" class="py-2 px-3 rounded hover:bg-gray-50 transition">البطاقات</a>
          <div class="pt-2 border-t border-gray-100 mt-2 flex justify-between items-center">
            <div class="flex items-center gap-3">
              <button id="mobileThemeToggle" class="text-gray-600">
                <i class="fa-solid fa-moon"></i>
              </button>
            </div>
            <a href="#" class="text-sm text-cyan-600 font-semibold">تسجيل دخول</a>
          </div>
        </div>
      </div>
    </div>
  </header>
  <script>
    // NAVBAR FUNCTIONALITY WITHOUT CART
    document.addEventListener('DOMContentLoaded', function () {
      const menuBtn = document.getElementById("menuBtn");
      const mobileNav = document.getElementById("mobileNav");
      const mobileThemeToggle = document.getElementById("mobileThemeToggle");

      // Mobile menu toggle
      if (menuBtn) {
        menuBtn.addEventListener("click", (e) => {
          const expanded = menuBtn.getAttribute("aria-expanded") === "true";
          menuBtn.setAttribute("aria-expanded", String(!expanded));
          mobileNav.classList.toggle("hidden");
        });
      }

      // Close mobile menu when clicking outside
      document.addEventListener("click", (e) => {
        if (!mobileNav || mobileNav.classList.contains("hidden")) return;
        const path = e.composedPath?.() || e.path || [];
        if (!path.includes(mobileNav) && !path.includes(menuBtn)) {
          mobileNav.classList.add("hidden");
          if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
        }
      });

      // Close mobile menu on window resize
      window.addEventListener("resize", () => {
        if (window.innerWidth >= 768) {
          mobileNav.classList.add("hidden");
          if (menuBtn) menuBtn.setAttribute("aria-expanded", "false");
        }
      });

      // Theme toggle
      document.getElementById("themeToggle")?.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
      });

      if (mobileThemeToggle) {
        mobileThemeToggle.addEventListener("click", () => {
          document.documentElement.classList.toggle("dark");
        });
      }
    });
  </script>

  <div class="max-w-6xl mx-auto">
    <div class="max-w-4xl mx-auto border-4 rounded-2xl shadow-xl overflow-hidden mb-8 p-4" id="template">
      <div class="bg-white rounded-xl p-6">
        <div
          class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8">
          <img src="../assets/imgs/card9/sub-period.webp" alt="img-title"
            class="w-full h-full object-cover rounded-full" />
        </div>
        <h1 class="text-4xl text-center">غلاف لأي تقرير أو ملف بالعرض (أفقي)</h1>
        <p class="text-gray-700 my-4 text-center text-xl">
          إنشاء وتخصيص غلاف لأي تقرير أو ملف بالعرض (أفقي) مع إمكانية تحرير وإضافة جميع البيانات الخاصة بك، بطريقة سهلة
          واحترافية توفر عليه الوقت والجهد ويتم حفظ الملف النهائي بتنسيق صورة أو ملف pdf لسهولة الطباعة بجودة عالية
          وإعادة الاستخدام في تقارير ونماذج أخرى.
        </p>

        <!-- نموذج الاستمارة -->
        <div class="mt-8 bg-white border border-gray-300 rounded-lg p-6">
          <!-- القسم العلوي: العنوان -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              العنوان:
            </label>
            <textarea id="title"
              class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows="3">
عنوان الملف
يتكون من سطرين</textarea>
            <div id="titleError" class="error-message">هذا الحقل مطلوب</div>
          </div>

          <!-- القسم الثاني: اسم المدرسة -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              اسم المدرسة:
            </label>
            <textarea id="schoolInfo"
              class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows="3">
اسم المدرسة
يتكون من سطرين</textarea>
            <div id="schoolInfoError" class="error-message">هذا الحقل مطلوب</div>
          </div>

          <!-- القسم الثالث: اسم معد الملف -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              اسم معد الملف:
            </label>
            <textarea id="prepInfo"
              class="w-full border border-gray-300 rounded-md p-3 text-gray-600 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500"
              rows="3">إعداد المعلم
اسم المعلم</textarea>
            <div id="prepInfoError" class="error-message">هذا الحقل مطلوب</div>
          </div>

          <!-- القسم الرابع: التاريخ -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              التاريخ:
            </label>
            <input type="text" id="dayDate"
              class="w-full border border-gray-300 rounded-md p-2 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
              value="الأحد - ١٤٤٧/١٢/١٢هـ" />
            <div id="dayDateError" class="error-message">
              هذا الحقل مطلوب
            </div>
          </div>

          <!-- زر المعاينة -->
          <div class="mt-8">
            <button onclick="previewTemplate()"
              class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              </svg>
              <span>معاينة</span>
            </button>
          </div>

          <!-- أكثر الروابط استخداماً -->
          <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6 mb-8 mt-8">
            <h2 class="text-lg font-bold text-gray-800 mb-4">
              أكثر الروابط استخداماً
            </h2>
            <div class="grid grid-cols-2 gap-4">
              <!-- الصف الأول -->
              <button
                class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]">
                أفضل نموذج لتوثيق برنامج أو نشاط (المطور)
              </button>
              <button
                class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]">
                تقرير جاهز لليوم العالمي للفيزياء الطبية
              </button>
              <!-- الصف الثاني -->
              <button
                class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]">
                نموذج تنفيذ استراتيجية مختصرة
              </button>
              <button
                class="border-2 border-blue-300 bg-white rounded-lg p-4 text-right hover:bg-[#3d7eb9] hover:text-white transition text-center font-bold text-[#3d7eb9]">
                خطط علاجية وإثرائية
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-12 footer-ink border-t border-gray-100">
    <div class="max-w-6xl mx-auto px-6 py-8 flex flex-col md:flex-row md:items-center md:justify-between gap-6">
      <!-- RIGHT COLUMN -->
      <div class="text-right md:flex-1">
        <img src="../assets/imgs/gsoor_logo.jpg" alt="logo" class="h-10 mx-auto md:mx-0" />
        <div class="flex justify-center md:justify-end gap-4 mt-3 text-gray-600">
          <i class="fa-brands fa-youtube social-icon text-lg"></i>
          <i class="fa-brands fa-tiktok social-icon text-lg"></i>
          <i class="fa-brands fa-instagram social-icon text-lg"></i>
        </div>
      </div>

      <!-- CENTER COLUMN -->
      <div class="text-center md:flex-1">
        <h3 class="font-bold mb-2">تواصل معنا</h3>
        <div class="flex items-center justify-center gap-4 text-gray-600">
          <div class="flex items-center gap-2">
            <i class="fa-regular fa-envelope text-sm"></i>
            <span>البريد</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="fa-solid fa-mobile-screen-button text-sm"></i>
            <span>واتس</span>
          </div>
        </div>
        <div class="mt-3 text-sm text-gray-500">موقّع لدى منصة الأعمال</div>
      </div>

      <!-- LEFT COLUMN -->
      <div class="text-left md:flex-1">
        <div class="text-sm text-gray-500">
          © 2025 متجر جسور الرقمي | جميع الحقوق محفوظة
        </div>
        <div class="mt-3 flex gap-2 items-center justify-center md:justify-start">
          <span class="sr-only">Visa</span>
          <i class="fa-brands fa-cc-visa text-gray-600 text-lg"></i>
          <span class="sr-only">Mada</span>
          <i class="fa-solid fa-credit-card text-gray-600 text-lg"></i>
        </div>
      </div>
    </div>
  </footer>

  <!-- Modal Popup للمعاينة -->
  <div id="previewModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="text-2xl font-bold text-gray-800">
          معاينة غلاف التقرير
        </h2>
        <button class="modal-close" id="closeModal">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <div id="previewTemplateContent" class="preview-template">
          <!-- سيتم ملء المحتوى ديناميكياً -->
        </div>
        <div class="flex justify-center gap-4 mt-6">
          <button onclick="downloadImageFromModal()"
            class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>
            تحميل كصورة
          </button>
          <button onclick="downloadPDFFromModal()"
            class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-700 transition flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>
            تحميل PDF
          </button>
          <button onclick="closePreviewModal()"
            class="bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 transition">
            إغلاق
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // دالة تبديل القائمة على الموبايل
    function toggleMobileMenu() {
      const menu = document.getElementById("navbarMenu");
      menu.classList.toggle("mobile-active");
    }

    // تهيئة التحقق من الحقول
    function setupFieldValidation() {
      const textFields = ['title', 'schoolInfo', 'prepInfo', 'dayDate'];

      // معالجة حقول النص
      textFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function () {
            this.classList.remove('field-error');
            const errorId = fieldId + 'Error';
            const error = document.getElementById(errorId);
            if (error) {
              error.classList.remove('show');
            }
          });
        }
      });
    }

    // دالة للتحقق من صحة البيانات
    function validateForm() {
      let isValid = true;

      // إزالة جميع رسائل الخطأ السابقة
      document.querySelectorAll(".field-error").forEach((field) => {
        field.classList.remove("field-error");
      });
      document.querySelectorAll(".error-message").forEach((error) => {
        error.classList.remove("show");
      });

      // التحقق من العنوان
      const title = document.getElementById("title").value.trim();
      if (!title) {
        showError("title", "titleError");
        isValid = false;
      }

      // التحقق من اسم المدرسة
      const schoolInfo = document.getElementById("schoolInfo").value.trim();
      if (!schoolInfo) {
        showError("schoolInfo", "schoolInfoError");
        isValid = false;
      }

      // التحقق من اسم معد الملف
      const prepInfo = document.getElementById("prepInfo").value.trim();
      if (!prepInfo) {
        showError("prepInfo", "prepInfoError");
        isValid = false;
      }

      // التحقق من التاريخ
      const dayDate = document.getElementById("dayDate").value.trim();
      if (!dayDate) {
        showError("dayDate", "dayDateError");
        isValid = false;
      }

      return isValid;
    }

    // دالة لإظهار رسالة الخطأ
    function showError(fieldId, errorId) {
      const field = document.getElementById(fieldId);
      const error = document.getElementById(errorId);
      if (field) {
        field.classList.add("field-error");
      }
      if (error) {
        error.classList.add("show");
      }
    }

    // دالة حفظ البيانات
    function saveFormData() {
      const formData = {
        title: document.getElementById('title').value,
        schoolInfo: document.getElementById('schoolInfo').value,
        prepInfo: document.getElementById('prepInfo').value,
        dayDate: document.getElementById('dayDate').value
      };

      localStorage.setItem('reportCoverData', JSON.stringify(formData));
      return formData;
    }

    // توليد محتوى المعاينة
    function generatePreviewContent() {
      const data = JSON.parse(localStorage.getItem('reportCoverData') || '{}');
      const previewContainer = document.getElementById("previewTemplateContent");

      // تقسيم النص إلى أسطر
      const titleLines = (data.title || "عنوان الملف\nيتكون من سطرين").split("\n");
      const schoolLines = (data.schoolInfo || "اسم المدرسة\nيتكون من سطرين").split("\n");
      const prepLines = (data.prepInfo || "إعداد المعلم\nاسم المعلم").split("\n");

      // إنشاء HTML للمعاينة
      const html = `
          <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl p-6">
              <div
                class="w-[300px] h-[300px] flex mx-auto rounded-full overflow-hidden items-center justify-center shadow-md mb-8"
              >
                <img
                  src="../assets/imgs/card9/sub-period.webp"
                  alt="img-title"
                  class="w-full h-full object-cover rounded-full"
                />
              </div>
              <h1 class="text-4xl text-center mb-4">غلاف لأي تقرير أو ملف بالعرض (أفقي)</h1>
              
              <div class="mt-8 bg-white border border-gray-300 rounded-lg p-6">
                <!-- العنوان -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    العنوان:
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 text-center text-xl font-bold">
                    ${titleLines.map(line => `<p>${line}</p>`).join('')}
                  </div>
                </div>

                <!-- اسم المدرسة -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    اسم المدرسة:
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 text-center text-lg">
                    ${schoolLines.map(line => `<p>${line}</p>`).join('')}
                  </div>
                </div>

                <!-- اسم معد الملف -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    اسم معد الملف:
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-3 text-gray-600 text-center">
                    ${prepLines.map(line => `<p>${line}</p>`).join('')}
                  </div>
                </div>

                <!-- التاريخ -->
                <div class="mb-6">
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    التاريخ:
                  </label>
                  <div class="bg-gray-50 border border-gray-300 rounded-md p-2 text-gray-600 text-center">
                    ${data.dayDate || "الأحد - ١٤٤٧/١٢/١٢هـ"}
                  </div>
                </div>

                <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded">
                  <p class="text-blue-700 text-center">
                    هذا الغلاف جاهز للاستخدام مع أي تقرير أو ملف بالعرض الأفقي
                  </p>
                </div>
              </div>
            </div>
          </div>
        `;

      previewContainer.innerHTML = html;
    }

    // دالة المعاينة
    function previewTemplate() {
      // التحقق من صحة البيانات أولاً
      if (!validateForm()) {
        // التمرير إلى أول حقل به خطأ
        const firstError = document.querySelector(".field-error");
        if (firstError) {
          firstError.scrollIntoView({ behavior: "smooth", block: "center" });
        }
        return;
      }

      // إذا كانت البيانات صحيحة، حفظها وفتح الـ modal
      saveFormData();
      generatePreviewContent();
      openPreviewModal();
    }

    // فتح الـ modal
    function openPreviewModal() {
      const modal = document.getElementById("previewModal");
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
    }

    // إغلاق الـ modal
    function closePreviewModal() {
      const modal = document.getElementById("previewModal");
      modal.classList.remove("active");
      document.body.style.overflow = "auto";
    }

    // إغلاق الـ modal عند الضغط خارج المحتوى
    document
      .getElementById("previewModal")
      ?.addEventListener("click", function (e) {
        if (e.target === this) {
          closePreviewModal();
        }
      });

    // إغلاق الـ modal عند الضغط على ESC
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") {
        closePreviewModal();
      }
    });

    // تحميل الصورة من الـ modal
    function downloadImageFromModal() {
      const previewContent = document.getElementById("previewTemplateContent");

      // إظهار رسالة تحميل
      const downloadBtn = event.target;
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = 'جاري التحميل...';
      downloadBtn.disabled = true;

      html2canvas(previewContent, {
        backgroundColor: "#ffffff",
        scale: 2,
        useCORS: true,
        logging: false
      }).then((canvas) => {
        const link = document.createElement("a");
        link.download = `غلاف-تقرير-${new Date().toLocaleDateString('ar-SA')}.png`;
        link.href = canvas.toDataURL();
        link.click();

        // إعادة زر التحميل إلى حالته الأصلية
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }).catch(error => {
        console.error('Error generating image:', error);
        alert('حدث خطأ أثناء تحميل الصورة');
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      });
    }

    // تحميل PDF من الـ modal
    function downloadPDFFromModal() {
      const previewContent = document.getElementById("previewTemplateContent");

      // إظهار رسالة تحميل
      const downloadBtn = event.target;
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = 'جاري التحميل...';
      downloadBtn.disabled = true;

      html2canvas(previewContent, {
        backgroundColor: "#ffffff",
        scale: 2,
        useCORS: true,
        logging: false
      }).then((canvas) => {
        const imgData = canvas.toDataURL("image/jpeg", 0.9);
        const pdf = new jspdf.jsPDF("p", "mm", "a4");
        const imgWidth = 210;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);
        pdf.save(`غلاف-تقرير-${new Date().toLocaleDateString('ar-SA')}.pdf`);

        // إعادة زر التحميل إلى حالته الأصلية
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }).catch(error => {
        console.error('Error generating PDF:', error);
        alert('حدث خطأ أثناء تحميل PDF');
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      });
    }

    // دالة لجعل textarea يتكيف تلقائياً مع المحتوى
    function autoResizeTextarea(textarea) {
      textarea.style.height = "auto";
      textarea.style.height = textarea.scrollHeight + "px";
      textarea.style.overflow = "hidden";
    }

    // تطبيق على جميع textarea عند تحميل الصفحة
    document.addEventListener("DOMContentLoaded", function () {
      // إعداد الـ validation
      setupFieldValidation();

      // تطبيق auto-resize على جميع textarea
      const textareas = document.querySelectorAll('textarea');
      textareas.forEach(textarea => {
        // تطبيق عند تحميل الصفحة
        autoResizeTextarea(textarea);
        // تطبيق عند الكتابة
        textarea.addEventListener('input', function () {
          autoResizeTextarea(this);
        });
      });

      // ربط زر إغلاق الـ modal
      document.getElementById('closeModal').addEventListener('click', closePreviewModal);

      // تحميل البيانات المحفوظة إن وجدت
      const savedData = JSON.parse(localStorage.getItem('reportCoverData') || '{}');
      Object.keys(savedData).forEach(key => {
        const field = document.getElementById(key);
        if (field) {
          field.value = savedData[key];
        }
      });
    });
  </script>
</body>

</html>
